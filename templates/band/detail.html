{% extends "base.html" %}
{% load static %}
{% load community_filters %}

{% block title %}{{ band.name }} - 배드민톡{% endblock %}

{% block extra_head %}
<style>
    .band-detail-container {
        position: relative;
        min-height: 400px;
        margin-top: 24px;
    }
    
    .band-cover-wrapper {
        position: relative;
        width: 100%;
        margin-bottom: 16px;
    }
    
    .band-cover-image {
        width: 100%;
        max-width: 1200px;
        border-radius: 12px;
        overflow: hidden;
        position: relative;
        background: #f1f5f9;
        display: flex;
        align-items: center;
        justify-content: center;
        margin: 0 auto;
    }

    .band-cover-image img {
        width: 100%;
        max-width: 1200px;
        height: auto;
        aspect-ratio: 8/3;
        object-fit: contain;
        object-position: center;
        display: block;
    }
    
    .band-image-grid {
        display: grid;
        grid-template-columns: repeat(auto-fill, minmax(200px, 1fr));
        gap: 8px;
        margin-top: 8px;
        width: 100%;
    }
    
    .band-image-grid-item {
        position: relative;
        width: 100%;
        overflow: hidden;
        border-radius: 8px;
        background: #f1f5f9;
        display: flex;
        align-items: center;
        justify-content: center;
    }
    
    .band-image-grid-item img {
        width: 100%;
        height: auto;
        max-height: 100%;
        display: block;
        object-fit: contain;
    }
    
    .band-content-grid {
        display: grid;
        grid-template-columns: 1fr 300px;
        gap: 24px;
        align-items: start;
        width: 100%;
        box-sizing: border-box;
    }
    
    .band-content-grid > * {
        min-width: 0;
        box-sizing: border-box;
    }
    
    .band-header-actions {
        display: flex;
        flex-wrap: wrap;
        gap: 8px;
    }
    
    .band-header-grid {
        display: grid;
        grid-template-columns: 1fr auto;
        gap: 24px;
        align-items: start;
    }
    
    .band-header-info {
        display: flex;
        align-items: flex-start;
        gap: 16px;
        flex-wrap: nowrap;
    }
    
    .band-header-actions-wrapper {
        display: flex;
        flex-direction: column;
        gap: 8px;
        align-items: flex-end;
        justify-content: flex-end;
    }
    
    .band-profile-image {
        width: 80px;
        height: 80px;
        min-width: 80px;
        border-radius: 12px;
        object-fit: cover;
        flex-shrink: 0;
    }
    
    .band-profile-placeholder {
        width: 80px;
        height: 80px;
        min-width: 80px;
        border-radius: 12px;
        background: var(--brand);
        display: flex;
        align-items: center;
        justify-content: center;
        color: white;
        font-size: 32px;
        font-weight: 700;
        flex-shrink: 0;
    }
    
    .band-header-text {
        flex: 1;
        min-width: 0;
        overflow: hidden;
    }
    
    .band-header-title {
        margin: 0;
        font-size: 24px;
        font-weight: 700;
        color: #1e293b;
        word-break: break-word;
        line-height: 1.3;
    }
    
    .band-header-description {
        margin: 8px 0 0 0;
        color: #64748b;
        word-break: break-word;
        line-height: 1.5;
    }
    
    .band-header-badges {
        display: flex;
        flex-direction: row;
        flex-wrap: wrap;
        gap: 4px;
        align-items: center;
        flex-shrink: 0;
    }
    
    .band-badge {
        display: inline-flex;
        align-items: center;
        padding: 2px 6px;
        border-radius: 4px;
        font-size: clamp(10px, 2.5vw, 12px);
        font-weight: 600;
        white-space: nowrap;
        flex-shrink: 0;
    }
    
    .band-badge-region {
        background: #d1fae5;
        color: #065f46;
    }
    
    .band-badge-category {
        color: #fff;
    }
    
    .band-badge-category-flash {
        background: #fbbf24;
    }
    
    .band-badge-category-group {
        background: var(--brand);
    }
    
    .band-badge-category-club {
        background: #3b82f6;
    }
    
    .band-badges-group {
        display: flex;
        flex-wrap: wrap;
        gap: 4px;
    }
    
    .band-description-box {
        padding: 20px;
        background: #fff;
        border: 1px solid #e2e8f0;
        border-radius: 12px;
        margin-bottom: 24px;
    }
    
    .band-description-box h3 {
        margin: 0 0 12px 0;
        font-size: 18px;
        font-weight: 700;
        color: #1e293b;
    }
    
    .band-description-content {
        color: #475569;
        line-height: 1.7;
        word-break: break-word;
        white-space: pre-wrap;
    }
    
    .band-description-empty {
        color: #94a3b8;
        font-style: italic;
    }
    
    .band-tabs {
        display: flex;
        gap: 0;
        border-bottom: 2px solid #e2e8f0;
        margin-bottom: 24px;
        margin-top: 24px;
    }
    
    .band-tab {
        padding: 12px 20px;
        font-size: 15px;
        font-weight: 600;
        color: #64748b;
        text-decoration: none;
        border-bottom: 2px solid transparent;
        margin-bottom: -2px;
        transition: all 0.2s ease;
        cursor: pointer;
        background: none;
        border-top: none;
        border-left: none;
        border-right: none;
    }
    
    .band-tab:hover {
        color: var(--brand);
    }
    
    .band-tab.active {
        color: var(--brand);
        border-bottom-color: var(--brand);
    }
    
    .band-tab-content {
        display: none;
        width: 100%;
        min-width: 0;
        box-sizing: border-box;
    }
    
    .band-tab-content.active {
        display: block;
    }
    
    .band-post-actions {
        display: flex;
        gap: 8px;
        flex-wrap: wrap;
    }
    
    .band-sidebar {
        display: flex;
        flex-direction: column;
        gap: 16px;
        height: fit-content;
        width: 100%;
        max-width: 300px;
        box-sizing: border-box;
    }
    
    @media (max-width: 767px) {
        .band-sidebar {
            max-width: 100%;
            width: 100%;
        }
    }
    
    .band-sidebar-actions {
        padding: 16px;
        background: #fff;
        border: 1px solid #e2e8f0;
        border-radius: 8px;
        margin-top: auto;
        box-sizing: border-box;
        width: 100%;
    }
    
    .band-sidebar-actions .band-header-actions {
        display: flex;
        flex-direction: column;
        gap: 8px;
        width: 100%;
    }
    
    .band-sidebar-actions .btn {
        width: 100%;
        justify-content: center;
        box-sizing: border-box;
        padding: 10px 12px;
        font-size: 14px;
    }
    
    .band-search-form {
        width: 100%;
        box-sizing: border-box;
        display: flex;
        gap: 8px;
    }
    
    .band-search-form input {
        flex: 1;
        box-sizing: border-box;
        min-width: 0;
    }
    
    .band-search-form button {
        flex-shrink: 0;
        box-sizing: border-box;
        white-space: nowrap;
    }
    
    /* 태블릿 (768px 이하) */
    @media (max-width: 768px) {
        .band-detail-container {
            margin-top: 16px;
        }

        .band-cover-image {
            max-width: 100%;
        }

        .band-cover-image img {
            width: 100%;
            height: auto;
            max-width: 100%;
            aspect-ratio: 8/3;
            object-fit: contain;
        }
        
        .band-image-grid {
            grid-template-columns: repeat(auto-fill, minmax(150px, 1fr));
            gap: 6px;
        }
        
        .band-content-grid {
            grid-template-columns: 1fr;
            gap: 16px;
            display: flex;
            flex-direction: column;
        }
        
        .band-header-info {
            gap: 12px;
        }
        
        .band-profile-image,
        .band-profile-placeholder {
            width: 64px;
            height: 64px;
            min-width: 64px;
            font-size: 24px;
        }
        
        .band-header-title {
            font-size: 20px;
        }
        
        .band-sidebar {
            order: 1;
        }
        
        .band-sidebar > div:first-child {
            order: 2;
        }
        
        .band-sidebar-actions {
            margin-top: 0;
            order: 1;
        }
    }
    
    /* 모바일 (640px 이하) */
    @media (max-width: 640px) {
        .band-detail-container {
            margin-top: 0;
        }
        
        .band-detail-container > div:first-child {
            margin-top: 0 !important;
        }
        
        .band-cover-image {
            max-width: 100%;
            border-radius: 8px;
        }

        .band-cover-image img {
            width: 100%;
            height: auto;
            max-width: 100%;
            aspect-ratio: 8/3;
            object-fit: contain;
        }
        
        .band-cover-wrapper {
            margin-bottom: 12px;
        }
        
        .band-image-grid {
            grid-template-columns: repeat(auto-fill, minmax(100px, 1fr));
            gap: 4px;
        }
        
        .band-image-grid-item {
            border-radius: 6px;
        }
        
        .band-content-grid {
            grid-template-columns: 1fr;
            gap: 16px;
        }
        
        .band-header-info {
            gap: 12px;
            flex-wrap: wrap;
        }
        
        .band-profile-image,
        .band-profile-placeholder {
            width: 56px;
            height: 56px;
            min-width: 56px;
            border-radius: 8px;
            font-size: 20px;
        }
        
        .band-header-title {
            font-size: 18px;
        }
        
        .band-header-description {
            font-size: 14px;
        }
        
        .band-header-badges {
            width: 100%;
            align-items: flex-start;
            margin-top: 8px;
            justify-content: flex-start;
        }
        
        .band-tabs {
            overflow-x: auto;
            -webkit-overflow-scrolling: touch;
            scrollbar-width: none;
            -ms-overflow-style: none;
        }
        
        .band-tabs::-webkit-scrollbar {
            display: none;
        }
        
        .band-tab {
            padding: 10px 16px;
            font-size: 14px;
            white-space: nowrap;
            flex-shrink: 0;
        }
        
        .band-badge {
            font-size: 12px;
            padding: 5px 10px;
        }
        
        .band-description-box {
            padding: 16px;
            margin-bottom: 20px;
            border-radius: 8px;
        }
        
        .band-description-box h3 {
            font-size: 16px;
            margin-bottom: 10px;
        }
        
        .band-description-content {
            font-size: 14px;
        }
        
        .band-post-actions {
            flex-direction: column;
        }
        
        .band-post-actions .btn {
            width: 100%;
            justify-content: center;
        }
        
        .band-content-grid {
            display: flex;
            flex-direction: column;
        }
        
        .band-sidebar {
            order: 1;
        }
        
        .band-sidebar > div:first-child {
            order: 2;
        }
        
        .band-sidebar-actions {
            margin-top: 0;
            order: 1;
        }
    }
    
    /* 공지 뱃지 스타일 강제 적용 - 인라인 스타일보다 우선순위 높임 */
    .band-tab-content .community-post-category {
        display: inline-block !important;
        padding: 4px 10px !important;
        border-radius: 4px !important;
        font-size: 12px !important;
        font-weight: 600 !important;
    }
    
    /* 공지 뱃지 - 빨간색 배경 강제 (인라인 스타일 속성 선택자 사용) */
    .band-tab-content span.community-post-category[style*="background: #dc2626"],
    .band-tab-content span.community-post-category[style*="background:#dc2626"] {
        background: #dc2626 !important;
        color: white !important;
    }
    
    /* 플로팅 액션 버튼 (FAB) */
    .fab-container {
        position: fixed;
        bottom: 24px;
        right: 24px;
        z-index: 1000;
    }
    
    .fab-button {
        width: 56px;
        height: 56px;
        border-radius: 50%;
        background: var(--brand);
        color: #fff;
        border: none;
        box-shadow: 0 4px 12px rgba(49, 170, 96, 0.4);
        cursor: pointer;
        display: flex;
        align-items: center;
        justify-content: center;
        font-size: 24px;
        transition: all 0.3s ease;
        position: relative;
    }
    
    .fab-button:hover {
        background: var(--brand-700);
        box-shadow: 0 6px 16px rgba(49, 170, 96, 0.5);
        transform: scale(1.05);
    }
    
    .fab-button.active {
        transform: rotate(45deg);
    }
    
    .fab-menu {
        position: absolute;
        bottom: 70px;
        right: 0;
        display: none;
        flex-direction: column;
        gap: 12px;
        min-width: 160px;
    }
    
    .fab-menu.active {
        display: flex;
    }
    
    .fab-menu-item {
        display: flex;
        align-items: center;
        gap: 12px;
        padding: 12px 16px;
        background: #fff;
        border-radius: 8px;
        box-shadow: 0 2px 8px rgba(0, 0, 0, 0.15);
        text-decoration: none;
        color: #1e293b;
        font-size: 14px;
        font-weight: 500;
        white-space: nowrap;
        transition: all 0.2s ease;
    }
    
    .fab-menu-item:hover {
        background: #f8fafc;
        transform: translateX(-4px);
    }
    
    .fab-menu-item-icon {
        width: 20px;
        height: 20px;
        display: flex;
        align-items: center;
        justify-content: center;
        font-size: 16px;
    }
    
    /* 모바일에서 기존 버튼 숨기기 */
    @media (max-width: 767px) {
        .band-sidebar-actions {
            display: none !important;
        }
        
        /* 모바일 반응형 최적화 */
        .d-day-badge {
            font-size: clamp(11px, 2.8vw, 13px) !important;
            padding: clamp(4px, 1.5vw, 6px) clamp(8px, 2.5vw, 12px) !important;
            white-space: nowrap !important;
            flex-shrink: 0 !important;
        }
        
        .schedule-title {
            font-size: clamp(14px, 3.5vw, 18px) !important;
            overflow: hidden !important;
            text-overflow: ellipsis !important;
            white-space: nowrap !important;
            flex: 1 !important;
            min-width: 0 !important;
        }
        
        .community-post-item {
            padding: clamp(12px, 3vw, 16px) !important;
            gap: clamp(10px, 2.5vw, 16px) !important;
        }
        
        .community-post-title {
            font-size: clamp(14px, 3.5vw, 16px) !important;
            overflow: hidden !important;
            text-overflow: ellipsis !important;
            white-space: nowrap !important;
        }
        
        .community-post-author {
            max-width: 80px !important;
            overflow: hidden !important;
            text-overflow: ellipsis !important;
            white-space: nowrap !important;
        }
        
        .community-post-meta {
            font-size: clamp(10px, 2.5vw, 12px) !important;
            gap: clamp(4px, 1.5vw, 8px) !important;
            flex-wrap: wrap !important;
        }
        
        .community-post-action-icon {
            font-size: clamp(12px, 3vw, 14px) !important;
        }
        
        .community-post-action-count {
            font-size: clamp(11px, 2.8vw, 13px) !important;
        }
    }
    
    /* 데스크톱에서 FAB 숨기기 */
    @media (min-width: 768px) {
        .fab-container {
            display: none !important;
        }
    }

    /* 모바일에서 FAQ 탭 레이아웃 수정 */
    @media (max-width: 640px) {
        #tab-question {
            padding: 0 !important;
            margin: 0 !important;
        }

        #tab-question > div {
            padding: 0 !important;
            margin: 0 0 16px 0 !important;
        }

        #questionForm {
            padding: 0 !important;
        }

        #questionInput {
            font-size: 13px !important;
            padding: 10px 50px 10px 10px !important;
        }

        .faq-item-header {
            padding: 10px 8px !important;
            gap: 8px !important;
        }

        .faq-item-header h3 {
            font-size: 13px !important;
        }

        .faq-item-header span[style*="font-size: 14px"] {
            font-size: 12px !important;
        }

        .faq-item-header > div:first-child {
            gap: 6px !important;
        }

        .accordion-content {
            padding-left: 8px !important;
            padding-right: 8px !important;
        }

        .band-description-box {
            margin-left: 0 !important;
            margin-right: 0 !important;
            padding: 16px !important;
        }
    }
</style>
{% endblock %}

{% block content %}
<section class="section" style="position: relative;">
    <div class="container band-detail-container">
        <!-- 메인 콘텐츠 (비로그인 시 블러 처리) -->
        <div class="{% if not user.is_authenticated %}content-blur{% endif %}">

        <!-- 밴드 헤더 -->
        <div style="margin-bottom: 24px;">
            {% if band.cover_image %}
                <div class="band-cover-wrapper">
                    <div class="band-cover-image">
                        <img 
                            src="{{ band.cover_image.url }}" 
                            alt="{{ band.name }}" 
                            loading="lazy"
                            decoding="async">
                    </div>
                    <!-- 이미지 그리드 (추후 이미지 데이터 추가 예정) -->
                    <div class="band-image-grid">
                        <!-- 예시: 이미지가 있을 때 표시 -->
                        <!-- 
                        {% for image in band.images.all %}
                            <div class="band-image-grid-item">
                                <img src="{{ image.url }}" alt="{{ band.name }} 이미지 {{ forloop.counter }}" loading="lazy">
                            </div>
                        {% endfor %}
                        -->
                    </div>
                </div>
            {% endif %}
        </div>
        
        <div class="band-content-grid">
            <!-- 게시글 목록 -->
            <div>
                <!-- 밴드 헤더 (프로필 정보만) -->
                <div class="band-header-info" style="margin-bottom: 24px;">
                {% if band.profile_image %}
                        <img src="{{ band.profile_image.url }}" alt="{{ band.name }}" class="band-profile-image">
                {% else %}
                        <div class="band-profile-placeholder">
                        {{ band.name|first }}
                        </div>
                    {% endif %}
                    <div class="band-header-text">
                        <h1 class="band-header-title">{{ band.name }}</h1>
                        {% if band.description %}
                            <p class="band-header-description" data-original-description="{{ band.description|escapejs }}">{{ band.description }}</p>
                        {% endif %}
                    </div>
                    <div class="band-header-badges">
                        {% if band.flash_region_detail %}
                            <span class="band-badge band-badge-region">{{ band.flash_region_detail }}</span>
                        {% elif band.region and band.region != 'all' %}
                            <span class="band-badge band-badge-region">{{ band.get_region_display }}</span>
                        {% endif %}
                        {% if band.category_items %}
                            {% for code, label in band.category_items %}
                                <span class="band-badge band-badge-category band-badge-category-{{ code }}">{{ label }}</span>
                            {% endfor %}
                        {% endif %}
                    </div>
                </div>
                
                <!-- 모임 설명란 -->
                {% if band.detailed_description %}
                <div class="band-description-box" style="width: 100%; max-width: 100%; box-sizing: border-box; overflow: hidden;">
                    <h3>모임 설명</h3>
                    <div class="band-description-content" style="width: 100%; box-sizing: border-box;">
                        {{ band.detailed_description|linebreaks }}
                    </div>
                    </div>
                {% endif %}
                
                <!-- 탭 메뉴 -->
                <div class="band-tabs">
                    <a href="?tab=home" class="band-tab {% if active_tab == 'home' or not active_tab %}active{% endif %}">홈</a>
                    <a href="?tab=flash" class="band-tab {% if active_tab == 'flash' %}active{% endif %}">번개</a>
                    <a href="?tab=board" class="band-tab {% if active_tab == 'board' %}active{% endif %}">게시판</a>
                    <a href="?tab=question" class="band-tab {% if active_tab == 'question' %}active{% endif %}">FAQ</a>
                </div>
                
                <!-- 홈 탭 -->
                <div class="band-tab-content {% if active_tab == 'home' or not active_tab %}active{% endif %}" id="tab-home">

                    <!-- 번개 목록 (최대 2개) -->
                    {% if home_schedules %}
                        <div style="display: flex; flex-direction: column; gap: 16px; margin-bottom: 32px;">
                            {% for schedule in home_schedules %}
                                <div class="flash-card" style="position: relative; padding: 20px; background: #fff; border: 1px solid #e2e8f0; border-radius: 12px; overflow: hidden;">
                                    <div style="display: flex; justify-content: space-between; align-items: flex-start; margin-bottom: 16px;">
                <div style="flex: 1;">
                                            <div style="display: flex; align-items: center; gap: clamp(6px, 2vw, 12px); margin-bottom: 12px; min-width: 0; width: 100%;">
                                                {% if schedule.d_day_text %}
                                                    <span class="d-day-badge" style="display: inline-block; padding: clamp(4px, 1.5vw, 6px) clamp(8px, 2.5vw, 12px); background: {% if schedule.d_day_is_past %}#94a3b8{% else %}#64748b{% endif %}; color: white; border-radius: 6px; font-size: clamp(11px, 2.8vw, 13px); font-weight: 600; white-space: nowrap; flex-shrink: 0;">{{ schedule.d_day_text }}</span>
                                                {% endif %}
                                                <h3 class="schedule-title" style="margin: 0; font-size: clamp(14px, 3.5vw, 18px); font-weight: 700; color: #1e293b; overflow: hidden; text-overflow: ellipsis; white-space: nowrap; flex: 1; min-width: 0;">{{ schedule.title|default:band.name }}</h3>
                                            </div>
                                            <div style="display: flex; flex-direction: column; gap: 8px; font-size: 14px; color: #1e293b;">
                                                <div>
                                                    <span style="color: #64748b;">일시:</span>
                                                    <span style="margin-left: 8px;">{{ schedule.start_datetime|date:"m.d(D) H:i" }}</span>
                                                </div>
                                                {% if schedule.location %}
                                                    <div>
                                                        <span style="color: #64748b;">위치:</span>
                                                        <span style="margin-left: 8px;">{{ schedule.location }}</span>
                                                    </div>
                                                {% endif %}
                                                {% if schedule.description %}
                                                    <div class="schedule-cost" data-description="{{ schedule.description|escapejs }}" style="display: none;">
                                                        <span style="color: #64748b;">비용:</span>
                                                        <span class="cost-value" style="margin-left: 8px;"></span>
                                                    </div>
                                                {% endif %}
                                                <div style="display: flex; align-items: center; gap: 8px; margin-top: 4px;">
                                                    {% if schedule.applications.all %}
                                                        {% with schedule.applications.all|first as first_app %}
                                                            {% if first_app.user.profile_image %}
                                                                <img src="{{ first_app.user.profile_image.url }}" alt="{{ first_app.user.real_name }}" style="width: 24px; height: 24px; border-radius: 50%; object-fit: cover;">
                                                            {% else %}
                                                                <div style="width: 24px; height: 24px; border-radius: 50%; background: var(--brand); display: flex; align-items: center; justify-content: center; color: white; font-size: 11px; font-weight: 600;">{{ first_app.user.real_name|first }}</div>
                                                            {% endif %}
                                                        {% endwith %}
                                                    {% endif %}
                                                    <span style="font-size: 13px; color: #64748b;">
                                                        {{ schedule.current_participants }}명 참석중
                                                        {% if schedule.max_participants %}
                                                            ({{ schedule.current_participants }}/{{ schedule.max_participants }})
                                                        {% endif %}
                                                    </span>
                                                </div>
                                            </div>
                                        </div>
                                        <div style="width: 120px; height: 160px; flex-shrink: 0; position: relative; border-radius: 8px; overflow: hidden; background: linear-gradient(135deg, #f1f5f9 0%, #e2e8f0 100%);">
                                            {% if schedule.images.all %}
                                                {% if schedule.images.all|length > 1 %}
                                                    <!-- 슬라이드 형식 (2장 이상) -->
                                                    <div class="schedule-image-slider" data-schedule-id="{{ schedule.id }}" style="position: relative; width: 100%; height: 100%; overflow: hidden;">
                                                        <div class="schedule-slider-track" style="display: flex; width: {% widthratio schedule.images.all|length 1 100 %}%; height: 100%; transition: transform 0.3s ease;">
                                                            {% for img in schedule.images.all %}
                                                                <div class="schedule-slide" style="width: {% widthratio 100 schedule.images.all|length 1 %}%; height: 100%; flex-shrink: 0;">
                                                                    <img src="{{ img.image.url }}" alt="번개 이미지 {{ forloop.counter }}" style="width: 100%; height: 100%; object-fit: cover;">
                                                                </div>
                                                            {% endfor %}
                                                        </div>
                                                        <div class="schedule-slider-dots" style="position: absolute; bottom: 8px; left: 50%; transform: translateX(-50%); display: flex; gap: 4px; z-index: 10;">
                                                            {% for img in schedule.images.all %}
                                                                <button type="button" class="schedule-dot" data-schedule-id="{{ schedule.id }}" data-slide="{{ forloop.counter0 }}" style="width: 6px; height: 6px; border-radius: 50%; border: none; background: {% if forloop.first %}white{% else %}rgba(255, 255, 255, 0.5){% endif %}; cursor: pointer; padding: 0;"></button>
                                                            {% endfor %}
                                                        </div>
                                                    </div>
                                                {% else %}
                                                    <!-- 단일 이미지 -->
                                                    <img src="{{ schedule.images.first.image.url }}" alt="번개 이미지" style="width: 100%; height: 100%; object-fit: cover;">
                                                {% endif %}
                                            {% else %}
                                                <div style="text-align: center; display: flex; flex-direction: column; align-items: center; justify-content: center; height: 100%;">
                                                    <div style="font-size: 11px; font-weight: 700; color: #1e293b; letter-spacing: 1px; margin-bottom: 4px;">MATCH</div>
                                                    <div style="font-size: 11px; font-weight: 700; color: #1e293b; letter-spacing: 1px;">POINT</div>
                                                </div>
                                            {% endif %}
                                        </div>
                                    </div>
                                    <div style="display: flex; gap: 8px; margin-top: 16px; padding-top: 16px; border-top: 1px solid #e2e8f0;">
                                        {% if member and member.role in "owner,admin"|make_list or band.created_by == user %}
                                            <a href="{% url 'band:schedule_update' band.id schedule.id %}" class="btn btn-ghost" style="flex: 1; text-align: center; padding: 10px; background: #f8fafc; border: 1px solid #e2e8f0; border-radius: 8px; text-decoration: none; color: #64748b; font-size: 14px; font-weight: 500;">수정</a>
                                        {% else %}
                                            <a href="#" class="btn btn-ghost" style="flex: 1; text-align: center; padding: 10px; background: #f8fafc; border: 1px solid #e2e8f0; border-radius: 8px; text-decoration: none; color: #64748b; font-size: 14px; font-weight: 500;">공유</a>
                                        {% endif %}
                                        {% if schedule.band.band_type == "flash" %}
                                            <a href="{% url 'band:detail' schedule.band.id %}" class="btn btn-primary" style="flex: 1; text-align: center; padding: 10px; background: #fff; border: 1px solid var(--brand); border-radius: 8px; text-decoration: none; color: var(--brand); font-size: 14px; font-weight: 500;">참석</a>
                                        {% else %}
                                            <a href="{% url 'band:schedule_detail' schedule.band.id schedule.id %}" class="btn btn-primary" style="flex: 1; text-align: center; padding: 10px; background: #fff; border: 1px solid var(--brand); border-radius: 8px; text-decoration: none; color: var(--brand); font-size: 14px; font-weight: 500;">참석</a>
                                        {% endif %}
                                    </div>
                                </div>
                            {% endfor %}
                        </div>
                    {% endif %}
                    
                    <!-- 게시판 글 목록 -->
                    {% if active_tab == "home" or not active_tab %}
                        {% if home_posts %}
                            <div style="margin-bottom: 32px;">
                                <h3 style="margin: 0 0 16px 0; font-size: 18px; font-weight: 700; color: #1e293b;">게시판</h3>
                                <div class="community-post-list" style="display: flex; flex-direction: column; gap: 16px;">
                                    {% for post in home_posts %}
                                    <a href="{% url 'band:post_detail' band.id post.id %}" class="community-post-item" style="display: flex; gap: 16px; padding: 16px; background: #fff; border: 1px solid #e2e8f0; border-radius: 8px; text-decoration: none; color: inherit; transition: all 0.2s ease;">
                                        <div class="community-post-content" style="flex: 1; display: flex; flex-direction: column; gap: 4px;">
                                            <div class="community-post-header" style="margin-bottom: 4px;">
                                                {% if post.is_notice or post.post_type == "announcement" %}
                                                    <span class="community-post-category" style="display: inline-block; padding: 4px 10px; background: #dc2626 !important; color: white !important; border-radius: 4px; font-size: 12px; font-weight: 600;">공지</span>
                                                {% elif post.is_pinned %}
                                                    <span class="community-post-category" style="display: inline-block; padding: 4px 10px; background: var(--brand); color: white; border-radius: 4px; font-size: 12px; font-weight: 600;">고정</span>
                                                {% else %}
                                                    <span class="community-post-category" style="display: inline-block; padding: 4px 10px; background: #EFEFEF; color: var(--brand); border-radius: 4px; font-size: 12px; font-weight: 600;">{{ post.get_post_type_display }}</span>
                                                {% endif %}
                                            </div>
                                            {% if post.title %}
                                                <h3 class="community-post-title" style="margin: 0; font-size: clamp(14px, 3.5vw, 16px); font-weight: 700; color: #1e293b; line-height: 1.4; overflow: hidden; text-overflow: ellipsis; white-space: nowrap; width: 100%;">{{ post.title }}</h3>
                                            {% endif %}
                                            <p class="community-post-excerpt" style="margin: 4px 0; font-size: clamp(12px, 3vw, 14px); color: #64748b; line-height: 1.5; display: -webkit-box; -webkit-line-clamp: 1; -webkit-box-orient: vertical; overflow: hidden; max-width: 100%; min-width: 0;">
                                                {% if post.content|striptags|length > 80 %}
                                                    {{ post.content|striptags|truncatewords:15 }}
                                                {% else %}
                                                    {{ post.content|striptags }}
                                                {% endif %}
                                            </p>
                                            <div class="community-post-meta" style="display: flex; align-items: center; gap: clamp(4px, 1.5vw, 8px); font-size: clamp(10px, 2.5vw, 12px); color: #94a3b8; flex-wrap: wrap; min-width: 0; width: 100%;">
                                                <span class="community-post-author" style="color: #64748b; white-space: nowrap; overflow: hidden; text-overflow: ellipsis; max-width: 100px; flex-shrink: 0;">{{ post.author.real_name }}</span>
                                                <span class="community-post-separator" style="color: #cbd5e1; flex-shrink: 0;">|</span>
                                                <span class="community-post-time" style="color: #94a3b8; white-space: nowrap; flex-shrink: 0;">
                                                    {% now "Y-m-d" as today %}
                                                    {% if post.created_at|date:"Y-m-d" == today %}
                                                        {{ post.created_at|timesince|truncatewords:1 }} 전
                                                    {% else %}
                                                        {{ post.created_at|date:"m.d" }}
                                                    {% endif %}
                                                </span>
                                                <span class="community-post-separator" style="color: #cbd5e1; flex-shrink: 0;">|</span>
                                                <span class="community-post-action" style="display: flex; align-items: center; gap: 3px; flex-shrink: 0;">
                                                    <span class="community-post-action-icon" style="display: inline-flex; align-items: center; width: clamp(12px, 3vw, 14px); height: clamp(12px, 3vw, 14px);">
                                                        <svg width="100%" height="100%" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                                                            <path d="M20.84 4.61a5.5 5.5 0 0 0-7.78 0L12 5.67l-1.06-1.06a5.5 5.5 0 0 0-7.78 7.78l1.06 1.06L12 21.23l7.78-7.78 1.06-1.06a5.5 5.5 0 0 0 0-7.78z"></path>
                                                        </svg>
                                                    </span>
                                                    <span class="community-post-action-count" style="font-size: clamp(11px, 2.8vw, 13px);">{{ post.like_count }}</span>
                                                </span>
                                                <span class="community-post-action" style="display: flex; align-items: center; gap: 3px; flex-shrink: 0;">
                                                    <span class="community-post-action-icon" style="display: inline-flex; align-items: center; width: clamp(12px, 3vw, 14px); height: clamp(12px, 3vw, 14px);">
                                                        <svg width="100%" height="100%" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                                                            <path d="M21 15a2 2 0 0 1-2 2H7l-4 4V5a2 2 0 0 1 2-2h14a2 2 0 0 1 2 2z"></path>
                                                        </svg>
                                                    </span>
                                                    <span class="community-post-action-count" style="font-size: clamp(11px, 2.8vw, 13px);">{{ post.comment_count }}</span>
                                                </span>
                                                <span class="community-post-action" style="display: flex; align-items: center; gap: 3px; flex-shrink: 0;">
                                                    <span class="community-post-action-icon" style="display: inline-flex; align-items: center; width: clamp(12px, 3vw, 14px); height: clamp(12px, 3vw, 14px);">
                                                        <svg width="100%" height="100%" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                                                            <path d="M1 12s4-8 11-8 11 8 11 8-4 8-11 8-11-8-11-8z"></path>
                                                            <circle cx="12" cy="12" r="3"></circle>
                                                        </svg>
                                                    </span>
                                                    <span class="community-post-action-count" style="font-size: clamp(11px, 2.8vw, 13px);">{{ post.view_count }}</span>
                                                </span>
                                            </div>
                                        </div>
                                        <div class="community-post-image" style="width: 120px; height: 120px; min-width: 120px; flex-shrink: 0; border-radius: 8px; overflow: hidden; background: #f1f5f9;">
                                            {% if post.content|extract_first_image %}
                                                <img src="{{ post.content|extract_first_image }}" alt="{{ post.title|default:'게시글 이미지' }}" class="community-post-thumbnail" style="width: 100%; height: 100%; object-fit: cover; display: block;" onerror="this.parentElement.innerHTML='<div style=\'width: 100%; height: 100%; display: flex; align-items: center; justify-content: center; color: #cbd5e1; font-size: 12px; background: #f8fafc;\'>이미지 없음</div>'">
                                            {% else %}
                                                <div class="community-post-no-image" style="width: 100%; height: 100%; display: flex; align-items: center; justify-content: center; color: #cbd5e1; font-size: 12px; background: #f8fafc;">이미지 없음</div>
                                            {% endif %}
                                        </div>
                                    </a>
                                    {% endfor %}
                                </div>
                            </div>
                        {% endif %}
                    {% endif %}
                    
                    <!-- FAQ 목록 -->
                    {% if active_tab == "home" or not active_tab %}
                        {% if question_posts %}
                            <div style="margin-bottom: 32px; width: 100%; max-width: 100%; box-sizing: border-box; overflow: hidden;">
                                <h3 style="margin: 0 0 16px 0; font-size: 18px; font-weight: 700; color: #1e293b;">FAQ</h3>
                                <div style="display: flex; flex-direction: column; gap: 0; width: 100%; max-width: 100%; box-sizing: border-box; overflow: hidden;">
                                    {% for post in question_posts|slice:":3" %}
                                        <div style="border-bottom: 1px solid #e2e8f0; width: 100%; box-sizing: border-box;">
                                            <div class="faq-item-header" style="display: flex; align-items: center; gap: 12px; padding: 12px 16px; background: #fff; transition: all 0.2s ease; cursor: pointer; box-sizing: border-box;" onclick="toggleQuestionAccordionHome({{ post.id }})">
                                                <div style="flex: 1; display: flex; align-items: center; gap: 10px; min-width: 0; overflow: hidden;">
                                                    <span style="display: inline-block; padding: 3px 8px; background: var(--brand); color: white; border-radius: 4px; font-size: 11px; font-weight: 600; white-space: nowrap; flex-shrink: 0;">FAQ</span>
                                                    <span style="width: 1px; height: 14px; background: #e2e8f0; flex-shrink: 0;"></span>
                                                    {% if post.comment_count > 0 %}
                                                        <span style="font-size: 14px; font-weight: 700; color: #3b82f6; white-space: nowrap; flex-shrink: 0;">[답변 완료]</span>
                                                    {% else %}
                                                        <span style="font-size: 14px; font-weight: 700; color: #475569; white-space: nowrap; flex-shrink: 0;">[답변 대기중]</span>
                                                    {% endif %}
                                                    <h3 style="margin: 0; font-size: 14px; font-weight: 500; color: #1e293b; flex: 1; white-space: nowrap; overflow: hidden; text-overflow: ellipsis; min-width: 0;">
                                                        {% if post.title %}{{ post.title }}{% else %}{{ post.content|striptags|truncatewords:10 }}{% endif %}
                                                    </h3>
                                                </div>
                                                <div style="display: flex; align-items: center; gap: 4px; padding: 4px 8px; color: #64748b; font-size: 12px; white-space: nowrap; flex-shrink: 0;" onclick="event.stopPropagation(); toggleQuestionAccordionHome({{ post.id }})">
                                                    답변 <span id="answerIconHome{{ post.id }}" style="font-size: 14px; line-height: 1; transition: transform 0.2s;">+</span>
                                                </div>
                                            </div>
                                            <div id="questionAccordionHome{{ post.id }}" class="accordion-content" style="max-height: 0; padding: 0 16px; background: #f8fafc; border-top: 1px solid #e2e8f0; box-sizing: border-box; overflow: hidden; opacity: 0; transition: max-height 0.3s ease, opacity 0.3s ease, padding-top 0.3s ease, padding-bottom 0.3s ease; width: 100%;">
                                                <!-- 답변 목록 -->
                                                <div style="margin-bottom: 12px; width: 100%; box-sizing: border-box;">
                                                    {% if post.comments.all %}
                                                        {% for comment in post.comments.all %}
                                                            <div style="padding: 10px 12px; background: #f8fafc; border-radius: 6px; margin-bottom: 6px; box-sizing: border-box; width: 100%;">
                                                                <div style="display: flex; align-items: center; gap: 6px; margin-bottom: 6px; flex-wrap: wrap;">
                                                                    <span style="font-size: 12px; font-weight: 600; color: #1e293b;">{{ comment.author.real_name }}</span>
                                                                    <span style="font-size: 11px; color: #94a3b8;">{{ comment.created_at|date:"Y.m.d H:i" }}</span>
                                                                    {% if comment.author == band.created_by %}
                                                                        <span style="font-size: 10px; padding: 2px 5px; background: var(--brand); color: white; border-radius: 3px;">운영자</span>
                                                                    {% elif member %}
                                                                        {% if member.role == "owner" or member.role == "admin" %}
                                                                            <span style="font-size: 10px; padding: 2px 5px; background: var(--brand); color: white; border-radius: 3px;">운영자</span>
                                                                        {% endif %}
                                                                    {% endif %}
                                                                </div>
                                                                <div style="font-size: 13px; color: #1e293b; line-height: 1.5; word-wrap: break-word; overflow-wrap: break-word; width: 100%; box-sizing: border-box;">
                                                                    {{ comment.content|linebreaks }}
                                                                </div>
                                                            </div>
                                                        {% endfor %}
                                                    {% else %}
                                                        <div style="display: flex; align-items: center; justify-content: center; padding: 16px; color: #cbd5e1; font-size: 13px; text-align: center;">
                                                            답변 대기 중이에요
                                                        </div>
                                                    {% endif %}
                                                </div>

                                                <!-- 답변 작성 폼 (모임장만) -->
                                                {% if member and member.role == "owner" %}
                                                    <form method="post" action="{% url 'band:comment_create' band.id post.id %}" style="box-sizing: border-box; margin-top: 12px; width: 100%;">
                                                        {% csrf_token %}
                                                        <input type="hidden" name="parent" value="">
                                                        <div style="display: flex; gap: 8px; align-items: center; width: 100%; box-sizing: border-box;">
                                                            <textarea name="content" rows="1" placeholder="답변을 작성하세요..." required style="flex: 1; padding: 8px 12px; border: 1px solid #e2e8f0; border-radius: 6px; font-size: 13px; font-family: inherit; resize: none; box-sizing: border-box; height: 40px; line-height: 1.4; min-width: 0;"></textarea>
                                                            <button type="submit" class="btn btn-primary" style="padding: 8px 20px; font-size: 13px; white-space: nowrap; height: 40px; flex-shrink: 0;">답변 작성</button>
                                                        </div>
                                                    </form>
                                                {% endif %}
                                            </div>
                                        </div>
                                    {% endfor %}
                                </div>
                                <script>
                                    function toggleQuestionAccordionHome(postId) {
                                        const accordion = document.getElementById('questionAccordionHome' + postId);
                                        const icon = document.getElementById('answerIconHome' + postId);
                                        
                                        if (accordion.style.maxHeight === '0px' || accordion.style.maxHeight === '') {
                                            // 먼저 높이를 계산하기 위해 임시로 max-height를 제거하고 패딩 복원
                                            const currentPadding = accordion.style.paddingTop;
                                            accordion.style.maxHeight = 'none';
                                            accordion.style.paddingTop = '12px';
                                            accordion.style.paddingBottom = '12px';
                                            const height = accordion.scrollHeight;
                                            accordion.style.maxHeight = '0px';
                                            accordion.style.paddingTop = '0px';
                                            accordion.style.paddingBottom = '0px';
                                            
                                            // 다음 프레임에서 트랜지션 시작
                                            requestAnimationFrame(() => {
                                                requestAnimationFrame(() => {
                                                    // 답변 작성 폼이 포함된 전체 높이를 위해 추가 여유 공간 확보
                                                    accordion.style.maxHeight = (height + 20) + 'px';
                                                    accordion.style.paddingTop = '12px';
                                                    accordion.style.paddingBottom = '16px';
                                                    accordion.style.opacity = '1';
                                                });
                                            });
                                            icon.textContent = '-';
                                        } else {
                                            accordion.style.maxHeight = '0px';
                                            accordion.style.paddingTop = '0px';
                                            accordion.style.paddingBottom = '0px';
                                            accordion.style.opacity = '0';
                                            icon.textContent = '+';
                                        }
                                    }
                                </script>
                            </div>
                        {% endif %}
                    {% endif %}
                    
                    {% if not schedules and not posts and not question_posts %}
                        <div style="padding: 48px; text-align: center; color: #64748b;">
                            <p>콘텐츠가 없습니다.</p>
                            {% if is_member %}
                            {% endif %}
                        </div>
                    {% endif %}
                </div>
                
                <!-- 번개 탭 -->
                <div class="band-tab-content {% if active_tab == 'flash' %}active{% endif %}" id="tab-flash">

                    {% if schedules_page %}
                        <div style="display: flex; flex-direction: column; gap: 16px;">
                            {% for schedule in schedules_page %}
                                <div class="flash-card" style="position: relative; padding: 20px; background: #fff; border: 1px solid #e2e8f0; border-radius: 12px; overflow: hidden;">
                                    <div style="display: flex; justify-content: space-between; align-items: flex-start; margin-bottom: 16px;">
                                        <div style="flex: 1;">
                                            <div style="display: flex; align-items: center; gap: clamp(6px, 2vw, 12px); margin-bottom: 12px; min-width: 0; width: 100%;">
                                                {% if schedule.d_day_text %}
                                                    <span class="d-day-badge" style="display: inline-block; padding: clamp(4px, 1.5vw, 6px) clamp(8px, 2.5vw, 12px); background: {% if schedule.d_day_is_past %}#94a3b8{% else %}#64748b{% endif %}; color: white; border-radius: 6px; font-size: clamp(11px, 2.8vw, 13px); font-weight: 600; white-space: nowrap; flex-shrink: 0;">{{ schedule.d_day_text }}</span>
                                                {% endif %}
                                                <h3 class="schedule-title" style="margin: 0; font-size: clamp(14px, 3.5vw, 18px); font-weight: 700; color: #1e293b; overflow: hidden; text-overflow: ellipsis; white-space: nowrap; flex: 1; min-width: 0;">{{ schedule.title|default:band.name }}</h3>
                                            </div>
                                            <div style="display: flex; flex-direction: column; gap: 8px; font-size: 14px; color: #1e293b;">
                                                <div>
                                                    <span style="color: #64748b;">일시:</span>
                                                    <span style="margin-left: 8px;">{{ schedule.start_datetime|date:"m.d(D) H:i" }}</span>
                                                </div>
                                                {% if schedule.location %}
                <div>
                                                        <span style="color: #64748b;">위치:</span>
                                                        <span style="margin-left: 8px;">{{ schedule.location }}</span>
                                                    </div>
                                                {% endif %}
                                                {% if schedule.description %}
                                                    <div class="schedule-cost" data-description="{{ schedule.description|escapejs }}" style="display: none;">
                                                        <span style="color: #64748b;">비용:</span>
                                                        <span class="cost-value" style="margin-left: 8px;"></span>
                                                    </div>
                                                {% endif %}
                                                <div style="display: flex; align-items: center; gap: 8px; margin-top: 4px;">
                                                    {% if schedule.applications.all %}
                                                        {% with schedule.applications.all|first as first_app %}
                                                            {% if first_app.user.profile_image %}
                                                                <img src="{{ first_app.user.profile_image.url }}" alt="{{ first_app.user.real_name }}" style="width: 24px; height: 24px; border-radius: 50%; object-fit: cover;">
                                                            {% else %}
                                                                <div style="width: 24px; height: 24px; border-radius: 50%; background: var(--brand); display: flex; align-items: center; justify-content: center; color: white; font-size: 11px; font-weight: 600;">{{ first_app.user.real_name|first }}</div>
                                                            {% endif %}
                                                        {% endwith %}
                                                    {% endif %}
                                                    <span style="font-size: 13px; color: #64748b;">
                                                        {{ schedule.current_participants }}명 참석중
                                                        {% if schedule.max_participants %}
                                                            ({{ schedule.current_participants }}/{{ schedule.max_participants }})
                                                        {% endif %}
                                                    </span>
                                                </div>
                                            </div>
                                        </div>
                                        <div style="width: 120px; height: 160px; flex-shrink: 0; position: relative; border-radius: 8px; overflow: hidden; background: linear-gradient(135deg, #f1f5f9 0%, #e2e8f0 100%);">
                                            {% if schedule.images.all %}
                                                {% if schedule.images.all|length > 1 %}
                                                    <!-- 슬라이드 형식 (2장 이상) -->
                                                    <div class="schedule-image-slider" data-schedule-id="{{ schedule.id }}" style="position: relative; width: 100%; height: 100%; overflow: hidden;">
                                                        <div class="schedule-slider-track" style="display: flex; width: {% widthratio schedule.images.all|length 1 100 %}%; height: 100%; transition: transform 0.3s ease;">
                                                            {% for img in schedule.images.all %}
                                                                <div class="schedule-slide" style="width: {% widthratio 100 schedule.images.all|length 1 %}%; height: 100%; flex-shrink: 0;">
                                                                    <img src="{{ img.image.url }}" alt="번개 이미지 {{ forloop.counter }}" style="width: 100%; height: 100%; object-fit: cover;">
                                                                </div>
                                                            {% endfor %}
                                                        </div>
                                                        <div class="schedule-slider-dots" style="position: absolute; bottom: 8px; left: 50%; transform: translateX(-50%); display: flex; gap: 4px; z-index: 10;">
                                                            {% for img in schedule.images.all %}
                                                                <button type="button" class="schedule-dot" data-schedule-id="{{ schedule.id }}" data-slide="{{ forloop.counter0 }}" style="width: 6px; height: 6px; border-radius: 50%; border: none; background: {% if forloop.first %}white{% else %}rgba(255, 255, 255, 0.5){% endif %}; cursor: pointer; padding: 0;"></button>
                                                            {% endfor %}
                                                        </div>
                                                    </div>
                                                {% else %}
                                                    <!-- 단일 이미지 -->
                                                    <img src="{{ schedule.images.first.image.url }}" alt="번개 이미지" style="width: 100%; height: 100%; object-fit: cover;">
                                                {% endif %}
                                            {% else %}
                                                <div style="text-align: center; display: flex; flex-direction: column; align-items: center; justify-content: center; height: 100%;">
                                                    <div style="font-size: 11px; font-weight: 700; color: #1e293b; letter-spacing: 1px; margin-bottom: 4px;">MATCH</div>
                                                    <div style="font-size: 11px; font-weight: 700; color: #1e293b; letter-spacing: 1px;">POINT</div>
                                                </div>
                                            {% endif %}
                                        </div>
                                    </div>
                                    <div style="display: flex; gap: 8px; margin-top: 16px; padding-top: 16px; border-top: 1px solid #e2e8f0;">
                                        {% if member and member.role in "owner,admin"|make_list or band.created_by == user %}
                                            <a href="{% url 'band:schedule_update' band.id schedule.id %}" class="btn btn-ghost" style="flex: 1; text-align: center; padding: 10px; background: #f8fafc; border: 1px solid #e2e8f0; border-radius: 8px; text-decoration: none; color: #64748b; font-size: 14px; font-weight: 500;">수정</a>
                                        {% else %}
                                            <a href="#" class="btn btn-ghost" style="flex: 1; text-align: center; padding: 10px; background: #f8fafc; border: 1px solid #e2e8f0; border-radius: 8px; text-decoration: none; color: #64748b; font-size: 14px; font-weight: 500;">공유</a>
                                        {% endif %}
                                        {% if schedule.band.band_type == "flash" %}
                                            <a href="{% url 'band:detail' schedule.band.id %}" class="btn btn-primary" style="flex: 1; text-align: center; padding: 10px; background: #fff; border: 1px solid var(--brand); border-radius: 8px; text-decoration: none; color: var(--brand); font-size: 14px; font-weight: 500;">참석</a>
                                        {% else %}
                                            <a href="{% url 'band:schedule_detail' schedule.band.id schedule.id %}" class="btn btn-primary" style="flex: 1; text-align: center; padding: 10px; background: #fff; border: 1px solid var(--brand); border-radius: 8px; text-decoration: none; color: var(--brand); font-size: 14px; font-weight: 500;">참석</a>
                                        {% endif %}
                                    </div>
                                </div>
                            {% endfor %}
                        </div>

                        <!-- 페이지네이션 -->
                        {% if schedules_page.has_other_pages %}
                            <div style="margin-top: 32px; display: flex; justify-content: center; align-items: center; gap: 8px;">
                                {% if schedules_page.has_previous %}
                                    <a href="?tab=flash&page={{ schedules_page.previous_page_number }}"
                                       style="padding: 8px 12px; background: #f8fafc; border: 1px solid #e2e8f0; border-radius: 6px; text-decoration: none; color: #64748b; font-size: 14px; transition: all 0.2s;">이전</a>
                                {% endif %}

                                {% for num in schedules_page.paginator.page_range %}
                                    {% if schedules_page.number == num %}
                                        <span style="padding: 8px 12px; background: var(--brand); border: 1px solid var(--brand); border-radius: 6px; color: white; font-size: 14px; font-weight: 600;">{{ num }}</span>
                                    {% elif num > schedules_page.number|add:'-3' and num < schedules_page.number|add:'3' %}
                                        <a href="?tab=flash&page={{ num }}"
                                           style="padding: 8px 12px; background: #f8fafc; border: 1px solid #e2e8f0; border-radius: 6px; text-decoration: none; color: #64748b; font-size: 14px; transition: all 0.2s;">{{ num }}</a>
                                    {% endif %}
                                {% endfor %}

                                {% if schedules_page.has_next %}
                                    <a href="?tab=flash&page={{ schedules_page.next_page_number }}"
                                       style="padding: 8px 12px; background: #f8fafc; border: 1px solid #e2e8f0; border-radius: 6px; text-decoration: none; color: #64748b; font-size: 14px; transition: all 0.2s;">다음</a>
                                {% endif %}
                            </div>
                        {% endif %}
                    {% else %}
                        <div style="padding: 48px; text-align: center; color: #64748b;">
                            <p>예정된 번개가 없습니다.</p>
                        </div>
                    {% endif %}
        </div>
        
                <!-- 게시판 탭 -->
                <div class="band-tab-content {% if active_tab == 'board' %}active{% endif %}" id="tab-board">
                
                {% if posts %}
                        <div class="community-post-list" style="display: flex; flex-direction: column; gap: 16px;">
                        {% for post in posts %}
                                <a href="{% url 'band:post_detail' band.id post.id %}" class="community-post-item" style="display: flex; gap: 16px; padding: 16px; background: #fff; border: 1px solid #e2e8f0; border-radius: 8px; text-decoration: none; color: inherit; transition: all 0.2s ease;">
                                    <div class="community-post-content" style="flex: 1; display: flex; flex-direction: column; gap: 4px;">
                                        <div class="community-post-header" style="margin-bottom: 4px;">
                                            {% if post.is_notice or post.post_type == "announcement" %}
                                                <span class="community-post-category" style="display: inline-block; padding: 4px 10px; background: #dc2626 !important; color: white !important; border-radius: 4px; font-size: 12px; font-weight: 600;">공지</span>
                                            {% elif post.is_pinned %}
                                                <span class="community-post-category" style="display: inline-block; padding: 4px 10px; background: var(--brand); color: white; border-radius: 4px; font-size: 12px; font-weight: 600;">고정</span>
                                            {% else %}
                                                <span class="community-post-category" style="display: inline-block; padding: 4px 10px; background: #EFEFEF; color: var(--brand); border-radius: 4px; font-size: 12px; font-weight: 600;">{{ post.get_post_type_display }}</span>
                                    {% endif %}
                                        </div>
                                        {% if post.title %}
                                            <h3 class="community-post-title" style="margin: 0; font-size: clamp(14px, 3.5vw, 16px); font-weight: 700; color: #1e293b; line-height: 1.4; overflow: hidden; text-overflow: ellipsis; white-space: nowrap; width: 100%;">{{ post.title }}</h3>
                                    {% endif %}
                                        <p class="community-post-excerpt" style="margin: 4px 0; font-size: clamp(12px, 3vw, 14px); color: #64748b; line-height: 1.5; display: -webkit-box; -webkit-line-clamp: 1; -webkit-box-orient: vertical; overflow: hidden; max-width: 100%; min-width: 0;">
                                            {% if post.content|striptags|length > 80 %}
                                                {{ post.content|striptags|truncatewords:15 }}
                                            {% else %}
                                                {{ post.content|striptags }}
                                    {% endif %}
                                        </p>
                                        <div class="community-post-meta" style="display: flex; align-items: center; gap: 8px; font-size: 12px; color: #94a3b8;">
                                            <span class="community-post-author" style="color: #64748b;">{{ post.author.real_name }}</span>
                                            <span class="community-post-separator" style="color: #cbd5e1;">|</span>
                                            <span class="community-post-time" style="color: #94a3b8;">
                                                {% now "Y-m-d" as today %}
                                                {% if post.created_at|date:"Y-m-d" == today %}
                                                    {{ post.created_at|timesince|truncatewords:1 }} 전
                                                {% else %}
                                                    {{ post.created_at|date:"m.d" }}
                                                {% endif %}
                                            </span>
                                            <span class="community-post-separator" style="color: #cbd5e1;">|</span>
                                            <span class="community-post-action" style="display: flex; align-items: center; gap: 4px;">
                                                <span class="community-post-action-icon" style="display: inline-flex; align-items: center; width: 14px; height: 14px;">
                                                    <svg width="100%" height="100%" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                                                        <path d="M20.84 4.61a5.5 5.5 0 0 0-7.78 0L12 5.67l-1.06-1.06a5.5 5.5 0 0 0-7.78 7.78l1.06 1.06L12 21.23l7.78-7.78 1.06-1.06a5.5 5.5 0 0 0 0-7.78z"></path>
                                                    </svg>
                                                </span>
                                                <span class="community-post-action-count" style="font-size: 13px;">{{ post.like_count }}</span>
                                            </span>
                                            <span class="community-post-action" style="display: flex; align-items: center; gap: 4px;">
                                                <span class="community-post-action-icon" style="display: inline-flex; align-items: center; width: 14px; height: 14px;">
                                                    <svg width="100%" height="100%" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                                                        <path d="M21 15a2 2 0 0 1-2 2H7l-4 4V5a2 2 0 0 1 2-2h14a2 2 0 0 1 2 2z"></path>
                                                    </svg>
                                                </span>
                                                <span class="community-post-action-count" style="font-size: 13px;">{{ post.comment_count }}</span>
                                            </span>
                                            <span class="community-post-action" style="display: flex; align-items: center; gap: 4px;">
                                                <span class="community-post-action-icon" style="display: inline-flex; align-items: center; width: 14px; height: 14px;">
                                                    <svg width="100%" height="100%" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                                                        <path d="M1 12s4-8 11-8 11 8 11 8-4 8-11 8-11-8-11-8z"></path>
                                                        <circle cx="12" cy="12" r="3"></circle>
                                                    </svg>
                                                </span>
                                                <span class="community-post-action-count" style="font-size: 13px;">{{ post.view_count }}</span>
                                            </span>
                                        </div>
                                    </div>
                                    <div class="community-post-image" style="width: 120px; height: 120px; min-width: 120px; flex-shrink: 0; border-radius: 8px; overflow: hidden; background: #f1f5f9;">
                                        {% if post.content|extract_first_image %}
                                            <img src="{{ post.content|extract_first_image }}" alt="{{ post.title|default:'게시글 이미지' }}" class="community-post-thumbnail" style="width: 100%; height: 100%; object-fit: cover; display: block;" onerror="this.parentElement.innerHTML='<div style=\'width: 100%; height: 100%; display: flex; align-items: center; justify-content: center; color: #cbd5e1; font-size: 12px; background: #f8fafc;\'>이미지 없음</div>'">
                                        {% else %}
                                            <div class="community-post-no-image" style="width: 100%; height: 100%; display: flex; align-items: center; justify-content: center; color: #cbd5e1; font-size: 12px; background: #f8fafc;">이미지 없음</div>
                                        {% endif %}
                                </div>
                            </a>
                        {% endfor %}
                    </div>
                    
                    <!-- 페이지네이션 -->
                    {% if posts.has_other_pages %}
                        <div style="margin-top: 32px; display: flex; justify-content: center; gap: 8px;">
                            {% if posts.has_previous %}
                                    <a href="?tab=board&page=1" class="btn btn-ghost">처음</a>
                                    <a href="?tab=board&page={{ posts.previous_page_number }}" class="btn btn-ghost">이전</a>
                            {% endif %}
                            <span style="display: flex; align-items: center; padding: 8px 16px; color: #64748b;">
                                {{ posts.number }} / {{ posts.paginator.num_pages }}
                            </span>
                            {% if posts.has_next %}
                                    <a href="?tab=board&page={{ posts.next_page_number }}" class="btn btn-ghost">다음</a>
                                    <a href="?tab=board&page={{ posts.paginator.num_pages }}" class="btn btn-ghost">마지막</a>
                            {% endif %}
                        </div>
                    {% endif %}
                {% else %}
                    <div style="padding: 48px; text-align: center; color: #64748b;">
                        <p>게시글이 없습니다.</p>
                        {% if is_member %}
                        {% endif %}
                    </div>
                {% endif %}
                </div>
                
                <!-- FAQ 탭 -->
                <div class="band-tab-content {% if active_tab == 'question' %}active{% endif %}" id="tab-question" style="max-width: 100%; overflow: hidden;">
                    {% if is_member %}
                        <div style="margin-bottom: 16px; width: 100%; max-width: 100%; box-sizing: border-box; min-width: 0; overflow: hidden;">
                            <form method="post" action="{% url 'band:post_create' band.id %}?tab=question" id="questionForm" style="position: relative; width: 100%; max-width: 100%; box-sizing: border-box; margin: 0; min-width: 0;">
                                {% csrf_token %}
                                <input type="hidden" name="post_type" value="question">
                                <input type="hidden" name="content" id="questionContent" value="">
                                <input type="text"
                                       name="title"
                                       id="questionInput"
                                       placeholder="질문을 입력하세요..."
                                       required
                                       style="width: 100%; max-width: 100%; padding: 12px 60px 12px 12px; border: 1px solid #e2e8f0; border-radius: 8px; font-size: 14px; box-sizing: border-box; font-family: inherit; min-width: 0;">
                                <button type="submit" style="position: absolute; right: 8px; top: 50%; transform: translateY(-50%); width: 32px; height: 32px; padding: 0 !important; margin: 0 !important; border-radius: 6px; display: flex; align-items: center; justify-content: center; border: none; cursor: pointer; background: var(--brand); z-index: 10;">
                                    <svg width="16" height="16" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg" style="stroke: white; stroke-width: 2; stroke-linecap: round; stroke-linejoin: round;">
                                        <line x1="12" y1="19" x2="12" y2="5"></line>
                                        <polyline points="5 12 12 5 19 12"></polyline>
                                    </svg>
                                </button>
                            </form>
                        </div>
                        <script>
                            document.getElementById('questionForm').addEventListener('submit', function(e) {
                                const titleInput = document.getElementById('questionInput');
                                const contentInput = document.getElementById('questionContent');
                                // title을 content로도 사용
                                if (titleInput.value.trim()) {
                                    contentInput.value = '<p>' + titleInput.value.trim() + '</p>';
                                }
                            });
                        </script>
                    {% endif %}

                    {% if question_posts %}
                        <div style="display: flex; flex-direction: column; gap: 0; width: 100%; max-width: 100%; box-sizing: border-box; overflow: hidden;">
                            {% for post in question_posts %}
                                <div style="border-bottom: 1px solid #e2e8f0; width: 100%; box-sizing: border-box;">
                                    <div class="faq-item-header" style="display: flex; align-items: center; gap: 12px; padding: 12px 16px; background: #fff; transition: all 0.2s ease; cursor: pointer; box-sizing: border-box;" onclick="toggleQuestionAccordion({{ post.id }})">
                                        <div style="flex: 1; display: flex; align-items: center; gap: 10px; min-width: 0; overflow: hidden;">
                                            <span style="display: inline-block; padding: 3px 8px; background: var(--brand); color: white; border-radius: 4px; font-size: 11px; font-weight: 600; white-space: nowrap; flex-shrink: 0;">FAQ</span>
                                            <span style="width: 1px; height: 14px; background: #e2e8f0; flex-shrink: 0;"></span>
                                            {% if post.comment_count > 0 %}
                                                <span style="font-size: 14px; font-weight: 700; color: #3b82f6; white-space: nowrap; flex-shrink: 0;">[답변 완료]</span>
                                            {% else %}
                                                <span style="font-size: 14px; font-weight: 700; color: #475569; white-space: nowrap; flex-shrink: 0;">[답변 대기중]</span>
                                            {% endif %}
                                            <h3 style="margin: 0; font-size: 14px; font-weight: 500; color: #1e293b; flex: 1; white-space: nowrap; overflow: hidden; text-overflow: ellipsis; min-width: 0;">
                                                {% if post.title %}{{ post.title }}{% else %}{{ post.content|striptags|truncatewords:10 }}{% endif %}
                                            </h3>
                                        </div>
                                        <div style="display: flex; align-items: center; gap: 4px; padding: 4px 8px; color: #64748b; font-size: 12px; white-space: nowrap; flex-shrink: 0;" onclick="event.stopPropagation(); toggleQuestionAccordion({{ post.id }})">
                                            답변 <span id="answerIcon{{ post.id }}" style="font-size: 14px; line-height: 1; transition: transform 0.2s;">+</span>
                                        </div>
                                    </div>
                                    <div id="questionAccordion{{ post.id }}" class="accordion-content" style="max-height: 0; padding: 0 16px; background: #f8fafc; border-top: 1px solid #e2e8f0; box-sizing: border-box; overflow: hidden; opacity: 0; transition: max-height 0.3s ease, opacity 0.3s ease, padding-top 0.3s ease, padding-bottom 0.3s ease; width: 100%;">
                                        <!-- 답변 목록 -->
                                        <div style="margin-bottom: 12px; width: 100%; box-sizing: border-box;">
                                            {% if post.comments.all %}
                                                {% for comment in post.comments.all %}
                                                    <div style="padding: 10px 12px 4px 12px; background: #f8fafc; border-radius: 6px; box-sizing: border-box; width: 100%;">
                                                        <div style="display: flex; align-items: center; gap: 6px; margin-bottom: 6px; flex-wrap: wrap;">
                                                            <span style="font-size: 12px; font-weight: 600; color: #1e293b;">{{ comment.author.real_name }}</span>
                                                            <span style="font-size: 11px; color: #94a3b8;">{{ comment.created_at|date:"Y.m.d H:i" }}</span>
                                                            {% if comment.author == band.created_by %}
                                                                <span style="font-size: 10px; padding: 2px 5px; background: var(--brand); color: white; border-radius: 3px;">운영자</span>
                                                            {% elif member %}
                                                                {% if member.role == "owner" or member.role == "admin" %}
                                                                    <span style="font-size: 10px; padding: 2px 5px; background: var(--brand); color: white; border-radius: 3px;">운영자</span>
                                                                {% endif %}
                                                            {% endif %}
                                                        </div>
                                                        <div style="font-size: 13px; color: #1e293b; line-height: 1.5; word-wrap: break-word; overflow-wrap: break-word; width: 100%; box-sizing: border-box;">
                                                            {{ comment.content|linebreaks }}
                                                        </div>
                                                    </div>
                                                {% endfor %}
                                            {% else %}
                                                <div style="display: flex; align-items: center; justify-content: center; padding: 16px; color: #cbd5e1; font-size: 13px; text-align: center;">
                                                    답변 대기 중이에요
                                                </div>
                                            {% endif %}
                                        </div>

                                        <!-- 답변 작성 폼 (모임장만) -->
                                        {% if member and member.role == "owner" %}
                                            <form method="post" action="{% url 'band:comment_create' band.id post.id %}" style="box-sizing: border-box; margin-top: 12px; width: 100%;">
                                                {% csrf_token %}
                                                <input type="hidden" name="parent" value="">
                                                <div style="display: flex; gap: 8px; align-items: center; width: 100%; box-sizing: border-box;">
                                                    <textarea name="content" rows="1" placeholder="답변을 작성하세요..." required style="flex: 1; padding: 8px 12px; border: 1px solid #e2e8f0; border-radius: 6px; font-size: 13px; font-family: inherit; resize: none; box-sizing: border-box; height: 40px; line-height: 1.4; min-width: 0;"></textarea>
                                                    <button type="submit" class="btn btn-primary" style="padding: 8px 20px; font-size: 13px; white-space: nowrap; height: 40px; flex-shrink: 0;">답변 작성</button>
                                                </div>
                                            </form>
                                        {% endif %}
                                    </div>
                                </div>
                            {% endfor %}
                        </div>
                        <script>
                            function toggleQuestionAccordion(postId) {
                                const accordion = document.getElementById('questionAccordion' + postId);
                                const icon = document.getElementById('answerIcon' + postId);
                                
                                if (accordion.style.maxHeight === '0px' || accordion.style.maxHeight === '') {
                                    // 먼저 높이를 계산하기 위해 임시로 max-height를 제거하고 패딩 복원
                                    const currentPadding = accordion.style.paddingTop;
                                    accordion.style.maxHeight = 'none';
                                    accordion.style.paddingTop = '12px';
                                    accordion.style.paddingBottom = '12px';
                                    const height = accordion.scrollHeight;
                                    accordion.style.maxHeight = '0px';
                                    accordion.style.paddingTop = '0px';
                                    accordion.style.paddingBottom = '0px';
                                    
                                    // 다음 프레임에서 트랜지션 시작
                                    requestAnimationFrame(() => {
                                        requestAnimationFrame(() => {
                                            // 답변 작성 폼이 포함된 전체 높이를 위해 추가 여유 공간 확보
                                            accordion.style.maxHeight = (height + 20) + 'px';
                                            accordion.style.paddingTop = '12px';
                                            accordion.style.paddingBottom = '16px';
                                            accordion.style.opacity = '1';
                                        });
                                    });
                                    icon.textContent = '-';
                                } else {
                                    accordion.style.maxHeight = '0px';
                                    accordion.style.paddingTop = '0px';
                                    accordion.style.paddingBottom = '0px';
                                    accordion.style.opacity = '0';
                                    icon.textContent = '+';
                                }
                            }
                        </script>
                    {% else %}
                        <div style="padding: 48px; text-align: center; color: #64748b;">
                            <p>FAQ가 없습니다.</p>
                        </div>
                    {% endif %}
                </div>
            </div>
            
            <!-- 사이드바 -->
            <div class="band-sidebar">
                <div style="padding: 20px; background: #fff; border: 1px solid #e2e8f0; border-radius: 8px;">
                    <div style="display: flex; align-items: center; justify-content: space-between; margin-bottom: 16px;">
                        <h3 style="margin: 0; font-size: 18px; font-weight: 700; color: #1e293b;">멤버</h3>
                        <span style="font-size: 14px; color: #64748b; font-weight: 600;">{{ total_member_count }}명</span>
                    </div>
                    <div style="display: flex; flex-direction: column; gap: 8px;">
                        {% for member in members %}
                            <div style="display: flex; align-items: center; gap: 8px;">
                                <img src="{{ member.user.profile_image_url }}" alt="{{ member.user.real_name }}" style="width: 32px; height: 32px; border-radius: 50%; object-fit: cover; flex-shrink: 0;">
                                <span style="font-size: 14px; color: #1e293b; flex: 1; min-width: 0; overflow: hidden; text-overflow: ellipsis; white-space: nowrap;">{{ member.user.real_name }}</span>
                                {% if member.role == "owner" %}
                                    <span style="font-size: 11px; color: var(--brand); flex-shrink: 0;">모임장</span>
                                {% elif member.role == "admin" %}
                                    <span style="font-size: 11px; color: #64748b; flex-shrink: 0;">관리자</span>
                                {% endif %}
                            </div>
                        {% endfor %}
                    </div>
                </div>
                
                <!-- 버튼 영역 (하단 정렬) -->
                <div class="band-sidebar-actions">
                    {% if is_member %}
                        <!-- 멤버용 버튼 -->
                        <div class="band-action-buttons" style="display: flex; flex-direction: column; gap: 8px; margin-bottom: 16px;">
                            <a href="{% url 'band:vote_create' band.id %}" class="btn btn-primary" style="width: 100%; text-align: center; padding: 12px; font-size: 14px; font-weight: 600; text-decoration: none; display: block;">투표 만들기</a>
                            <a href="{% url 'band:schedule_create' band.id %}" class="btn btn-primary" style="width: 100%; text-align: center; padding: 12px; font-size: 14px; font-weight: 600; text-decoration: none; display: block;">번개 만들기</a>
                            <a href="{% url 'band:post_create' band.id %}" class="btn btn-primary" style="width: 100%; text-align: center; padding: 12px; font-size: 14px; font-weight: 600; text-decoration: none; display: block;">게시판 글쓰기</a>
                        </div>
                    {% endif %}
                    
                    <div class="band-header-actions">
                        {% if is_creator %}
                            <a href="{% url 'band:update' band.id %}" class="btn btn-primary band-action-btn">모임 수정</a>
                            <a href="{% url 'band:member_management' band.id %}" class="btn btn-primary band-action-btn">멤버 관리</a>
                        {% endif %}
                        {% if is_member %}
                            {% if member.role == "owner" or member.role == "admin" %}
                                <!-- 관리자는 모임 삭제 -->
                                {% if not band.deletion_requested %}
                                    <a href="{% url 'band:delete_request' band.id %}" class="btn btn-ghost band-action-btn" style="color: #dc2626; border-color: #dc2626;">모임 삭제</a>
                                {% else %}
                                    <span class="btn btn-ghost band-action-btn" style="color: #64748b; border-color: #e2e8f0; cursor: not-allowed;">삭제 신청 대기 중</span>
                                {% endif %}
                            {% else %}
                                <!-- 일반 사용자는 탈퇴 -->
                                <a href="{% url 'band:leave' band.id %}" class="btn btn-ghost band-action-btn" onclick="return confirm('정말 탈퇴하시겠습니까?')">탈퇴</a>
                            {% endif %}
                        {% else %}
                            <a href="{% url 'band:join' band.id %}" class="btn btn-primary band-action-btn">가입하기</a>
                        {% endif %}
                    </div>
                </div>
            </div>
        </div>
    </div>
</section>

<script>
document.addEventListener('DOMContentLoaded', function() {
    // 밴드 헤더 설명에서 "위치:" 텍스트 제거
    const descriptionElement = document.querySelector('.band-header-description');
    if (descriptionElement) {
        let text = descriptionElement.textContent || descriptionElement.innerText;
        // "위치:"로 시작하는 줄 제거
        text = text.split('\n').filter(line => !line.trim().startsWith('위치:')).join('\n').trim();
        descriptionElement.textContent = text;
    }
    
    // 번개 카드에서 비용 정보 추출 및 표시
    const costElements = document.querySelectorAll('.schedule-cost');
    costElements.forEach(function(element) {
        const description = element.getAttribute('data-description');
        if (description) {
            // "참가비:" 또는 "비용:" 패턴 찾기
            const costMatch = description.match(/(?:참가비|비용):\s*([0-9,]+)\s*원/);
            if (costMatch) {
                const costValue = costMatch[1];
                const costValueSpan = element.querySelector('.cost-value');
                if (costValueSpan) {
                    costValueSpan.textContent = '입장료 ' + costValue + '원';
                    element.style.display = 'block';
                }
            }
        }
    });
    
    // 번개 이름에서 날짜 부분 숨기기 (예: "모임 탭 변경 테스트 - 2025-12-06"에서 " - 2025-12-06" 숨김)
    const scheduleTitles = document.querySelectorAll('.schedule-title');
    scheduleTitles.forEach(function(element) {
        const fullText = element.textContent || element.innerText;
        if (fullText) {
            // " - YYYY-MM-DD" 또는 " - YYYY.MM.DD" 패턴 찾기
            const datePattern = /\s*-\s*\d{4}[-.]\d{2}[-.]\d{2}/;
            if (datePattern.test(fullText)) {
                // 날짜 부분을 span으로 감싸서 숨기기
                const cleanedText = fullText.replace(datePattern, '');
                const dateMatch = fullText.match(datePattern);
                if (dateMatch) {
                    element.innerHTML = cleanedText + '<span style="display: none;">' + dateMatch[0] + '</span>';
                }
            }
        }
    });

    // 번개 이미지 슬라이드 기능
    document.querySelectorAll('.schedule-dot').forEach(dot => {
        dot.addEventListener('click', function() {
            const scheduleId = this.getAttribute('data-schedule-id');
            const slideIndex = parseInt(this.getAttribute('data-slide'));
            const slider = document.querySelector(`.schedule-image-slider[data-schedule-id="${scheduleId}"]`);
            const track = slider.querySelector('.schedule-slider-track');
            const slides = slider.querySelectorAll('.schedule-slide');
            const dots = slider.querySelectorAll('.schedule-dot');
            
            // 슬라이드 이동
            const slideWidth = 100 / slides.length;
            track.style.transform = `translateX(-${slideIndex * slideWidth}%)`;
            
            // 도트 업데이트
            dots.forEach((d, index) => {
                d.style.background = index === slideIndex ? 'white' : 'rgba(255, 255, 255, 0.5)';
            });
        });
    });

    // 자동 슬라이드 (선택사항)
    document.querySelectorAll('.schedule-image-slider').forEach(slider => {
        const scheduleId = slider.getAttribute('data-schedule-id');
        const slides = slider.querySelectorAll('.schedule-slide');
        if (slides.length <= 1) return;
        
        let currentSlide = 0;
        const dots = slider.querySelectorAll('.schedule-dot');
        const track = slider.querySelector('.schedule-slider-track');
        
        setInterval(() => {
            currentSlide = (currentSlide + 1) % slides.length;
            const slideWidth = 100 / slides.length;
            track.style.transform = `translateX(-${currentSlide * slideWidth}%)`;
            
            dots.forEach((d, index) => {
                d.style.background = index === currentSlide ? 'white' : 'rgba(255, 255, 255, 0.5)';
            });
        }, 3000);
    });
    
    // 플로팅 액션 버튼 (FAB)
    const fabButton = document.getElementById('fab-button');
    const fabMenu = document.getElementById('fab-menu');
    
    if (fabButton && fabMenu) {
        fabButton.addEventListener('click', function(e) {
            e.stopPropagation();
            fabButton.classList.toggle('active');
            fabMenu.classList.toggle('active');
        });
        
        // 외부 클릭 시 메뉴 닫기
        document.addEventListener('click', function(e) {
            if (!fabButton.contains(e.target) && !fabMenu.contains(e.target)) {
                fabButton.classList.remove('active');
                fabMenu.classList.remove('active');
            }
        });
    }
});
</script>

<!-- 플로팅 액션 버튼 (FAB) - 모바일 전용 -->
<div class="fab-container">
    <button id="fab-button" class="fab-button" aria-label="메뉴 열기">
        +
    </button>
    <div id="fab-menu" class="fab-menu">
        {% if is_member %}
            <a href="{% url 'band:vote_create' band.id %}" class="fab-menu-item">
                <span class="fab-menu-item-icon">📊</span>
                <span>투표 만들기</span>
            </a>
            <a href="{% url 'band:schedule_create' band.id %}" class="fab-menu-item">
                <span class="fab-menu-item-icon">⚡</span>
                <span>번개 만들기</span>
            </a>
            <a href="{% url 'band:post_create' band.id %}" class="fab-menu-item">
                <span class="fab-menu-item-icon">✍️</span>
                <span>게시판 글쓰기</span>
            </a>
            {% if is_creator %}
                <a href="{% url 'band:update' band.id %}" class="fab-menu-item">
                    <span class="fab-menu-item-icon">✏️</span>
                    <span>모임 수정</span>
                </a>
            {% endif %}
            {% if member.role == "owner" or member.role == "admin" %}
                {% if not band.deletion_requested %}
                    <a href="{% url 'band:delete_request' band.id %}" class="fab-menu-item" style="color: #dc2626;">
                        <span class="fab-menu-item-icon">🗑️</span>
                        <span>모임 삭제</span>
                    </a>
                {% endif %}
            {% else %}
                <a href="{% url 'band:leave' band.id %}" class="fab-menu-item" onclick="return confirm('정말 탈퇴하시겠습니까?')" style="color: #dc2626;">
                    <span class="fab-menu-item-icon">👋</span>
                    <span>탈퇴</span>
                </a>
            {% endif %}
        {% else %}
            <a href="{% url 'band:join' band.id %}" class="fab-menu-item">
                <span class="fab-menu-item-icon">➕</span>
                <span>가입하기</span>
            </a>
        {% endif %}
    </div>

    </div>
    <!-- 메인 콘텐츠 끝 -->

    <!-- 비로그인 사용자용 회원가입 유도 모달 -->
    {% if not user.is_authenticated %}
    <div class="signup-modal">
        <div class="signup-modal-content">
            <div class="signup-modal-icon">🏸</div>
            <h2 class="signup-modal-title">전체 내용을 보려면<br>회원가입이 필요해요</h2>
            <p class="signup-modal-desc">배드민톡에 가입하고<br>다양한 배드민턴 정보를 확인하세요!</p>
            <div class="signup-modal-buttons">
                <a href="{% url 'accounts:signup' %}" class="signup-modal-btn-primary">회원가입하기</a>
                <a href="{% url 'accounts:login' %}" class="signup-modal-btn-secondary">로그인</a>
            </div>
        </div>
    </div>
    <style>
        /* 콘텐츠 블러 효과 */
        .content-blur {
            filter: blur(8px);
            pointer-events: none;
            user-select: none;
        }

        /* 회원가입 유도 모달 */
        .signup-modal {
            position: fixed;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            z-index: 1000;
            background: #fff;
            border-radius: 20px;
            box-shadow: 0 20px 60px rgba(0, 0, 0, 0.3);
            padding: 48px 40px;
            max-width: 440px;
            width: 90%;
            text-align: center;
            animation: modalFadeIn 0.3s ease;
        }

        @keyframes modalFadeIn {
            from {
                opacity: 0;
                transform: translate(-50%, -45%);
            }
            to {
                opacity: 1;
                transform: translate(-50%, -50%);
            }
        }

        .signup-modal-icon {
            font-size: 64px;
            margin-bottom: 24px;
            animation: bounce 2s ease-in-out infinite;
        }

        @keyframes bounce {
            0%, 100% {
                transform: translateY(0);
            }
            50% {
                transform: translateY(-10px);
            }
        }

        .signup-modal-title {
            font-size: 24px;
            font-weight: 700;
            color: #1e293b;
            margin: 0 0 16px 0;
            line-height: 1.4;
        }

        .signup-modal-desc {
            font-size: 16px;
            color: #64748b;
            margin: 0 0 32px 0;
            line-height: 1.6;
        }

        .signup-modal-buttons {
            display: flex;
            flex-direction: column;
            gap: 12px;
        }

        .signup-modal-btn-primary {
            display: block;
            padding: 16px 32px;
            background: var(--brand);
            color: #fff;
            text-decoration: none;
            border-radius: 12px;
            font-size: 16px;
            font-weight: 600;
            transition: all 0.2s ease;
            box-shadow: 0 4px 12px rgba(49, 170, 96, 0.3);
        }

        .signup-modal-btn-primary:hover {
            background: #2d9c5a;
            box-shadow: 0 6px 20px rgba(49, 170, 96, 0.4);
            transform: translateY(-2px);
        }

        .signup-modal-btn-secondary {
            display: block;
            padding: 16px 32px;
            background: #f8fafc;
            color: #64748b;
            text-decoration: none;
            border-radius: 12px;
            font-size: 16px;
            font-weight: 500;
            transition: all 0.2s ease;
            border: 1px solid #e2e8f0;
        }

        .signup-modal-btn-secondary:hover {
            background: #f1f5f9;
            color: #475569;
            border-color: #cbd5e1;
        }

        /* 모바일 최적화 */
        @media (max-width: 768px) {
            .signup-modal {
                padding: 36px 24px;
                border-radius: 16px;
                max-width: 90%;
            }

            .signup-modal-icon {
                font-size: 56px;
                margin-bottom: 20px;
            }

            .signup-modal-title {
                font-size: 20px;
                margin-bottom: 12px;
            }

            .signup-modal-desc {
                font-size: 14px;
                margin-bottom: 24px;
            }

            .signup-modal-btn-primary,
            .signup-modal-btn-secondary {
                padding: 14px 24px;
                font-size: 15px;
            }
        }

        @media (max-width: 480px) {
            .signup-modal {
                padding: 28px 20px;
                width: 85%;
            }

            .signup-modal-icon {
                font-size: 48px;
                margin-bottom: 16px;
            }

            .signup-modal-title {
                font-size: 18px;
            }

            .signup-modal-desc {
                font-size: 13px;
            }

            .signup-modal-btn-primary,
            .signup-modal-btn-secondary {
                padding: 12px 20px;
                font-size: 14px;
            }
        }
    </style>
    {% endif %}
</div>
{% endblock %}

