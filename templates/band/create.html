{% extends "base.html" %}

{% block title %}{% if is_update %}{% if band_type == 'flash' %}ë²ˆê°œ ìˆ˜ì •í•˜ê¸°{% else %}ëª¨ì„ ìˆ˜ì •í•˜ê¸°{% endif %}{% else %}{% if band_type == 'flash' %}ë²ˆê°œ ë§Œë“¤ê¸°{% else %}ëª¨ì„ ë§Œë“¤ê¸°{% endif %}{% endif %} - ë°°ë“œë¯¼í†¡{% endblock %}

{% block content %}
<section class="section" style="position: relative;">
    <div class="container" style="position: relative; min-height: 400px; margin-top: 0;">
        <div style="max-width: 600px; margin: 0 auto; background: #fff; border-radius: 12px; padding: 24px; box-shadow: 0 2px 8px rgba(0, 0, 0, 0.05);">
            <div style="display: flex; align-items: center; gap: 16px; margin-bottom: 24px;">
                <a href="{% if parent_band %}{% url 'band:detail' parent_band.id %}?tab=flash{% elif is_update %}{% url 'band:detail' band.id %}{% else %}{% url 'band:list' %}{% if band_type %}?type={{ band_type }}{% endif %}{% endif %}" style="text-decoration: none; color: #1e293b; font-size: 20px; line-height: 1;">&lt;</a>
                <h1 style="margin: 0; font-size: 20px; font-weight: 700; color: #1e293b;">{% if is_update %}{% if band_type == 'flash' %}ë²ˆê°œ ìˆ˜ì •í•˜ê¸°{% else %}ëª¨ì„ ìˆ˜ì •í•˜ê¸°{% endif %}{% else %}{% if band_type == 'flash' %}ë²ˆê°œ ë§Œë“¤ê¸°{% else %}ëª¨ì„ ë§Œë“¤ê¸°{% endif %}{% endif %}</h1>
            </div>
            
            <form method="post" enctype="multipart/form-data" id="bandForm" action="{% if is_update and schedule %}{% url 'band:schedule_update' parent_band.id schedule.id %}{% elif parent_band %}{% url 'band:schedule_create' parent_band.id %}{% endif %}">
            {% csrf_token %}

            {% if form.errors %}
                    <div style="margin-bottom: 20px; padding: 12px; background: #fee2e2; border: 1px solid #fca5a5; border-radius: 6px; color: #dc2626;">
                    {% for field, errors in form.errors.items %}
                        {% for error in errors %}
                                <p style="margin: 0; font-size: 14px;">{{ error }}</p>
                        {% endfor %}
                    {% endfor %}
                </div>
            {% endif %}
            
                <!-- ë¶„ë¥˜ (ì¤‘ë³µ ì„ íƒ ê°€ëŠ¥) - ëª¨ì„/ë™í˜¸íšŒë§Œ í‘œì‹œ -->
                {% if band_type != 'flash' %}
                <div style="margin-bottom: 24px;">
                    <label style="display: block; margin-bottom: 6px; font-size: 14px; font-weight: 600; color: #1e293b;">
                        ë¶„ë¥˜
                    </label>
                    <p style="margin: 0 0 10px 0; font-size: 12px; color: #64748b;">
                        ì—¬ëŸ¬ ê°œë¥¼ ì„ íƒí•  ìˆ˜ ìˆì–´ìš”.
                    </p>
                    <div style="border: 1px solid #e2e8f0; border-radius: 8px; padding: 10px 12px; background: #f8fafc;">
                        <div style="display: flex; flex-wrap: wrap; gap: 12px;">
                            {% for value, label in form.CATEGORY_CHOICES %}
                                {% with selected_list=form.categories.value %}
                                    <label style="display: inline-flex; align-items: center; gap: 6px; font-size: 13px; color: #1e293b; cursor: pointer;">
                                        <input type="checkbox"
                                               name="{{ form.categories.html_name }}"
                                               value="{{ value }}"
                                               {% if selected_list and value in selected_list %}checked{% endif %}
                                               style="width: 14px; height: 14px; cursor: pointer; accent-color: var(--brand);">
                                        <span>{{ label }}</span>
                                    </label>
                                {% endwith %}
                            {% endfor %}
                        </div>
                    </div>
                </div>
                {% endif %}
                
                {% if band_type == 'flash' %}
                    <!-- ë²ˆê°œ íƒ€ì…: ì´ë¯¸ì§€ì™€ ë™ì¼í•œ í¼ -->
                    
                    <!-- ì´ë¯¸ì§€ ì—…ë¡œë“œ (3:4 ë¹„ìœ¨, ìµœëŒ€ 5ì¥) -->
                    <div style="margin-bottom: 24px;">
                        <div style="display: flex; align-items: center; justify-content: space-between; margin-bottom: 8px;">
                            <label style="display: block; font-size: 14px; font-weight: 600; color: #1e293b;">
                                ë²ˆê°œ ì‚¬ì§„ (ìµœëŒ€ 5ì¥, 3:4 ë¹„ìœ¨)
                            </label>
                            <span id="imageCount" style="font-size: 12px; color: #64748b;">0/5</span>
                        </div>
                        <input type="file" id="schedule_images" name="schedule_images" accept="image/*" multiple style="display: none;" onchange="handleScheduleImages(this)">
                        <div id="scheduleImagesContainer" style="display: grid; grid-template-columns: repeat(2, 1fr); gap: 12px;">
                            <!-- ê¸°ì¡´ ì´ë¯¸ì§€ í‘œì‹œ -->
                            {% if is_update and existing_images %}
                                {% for img in existing_images %}
                                    <div data-existing-image="{{ img.id }}" style="position: relative; aspect-ratio: 3/4; border-radius: 8px; overflow: hidden; border: 1px solid #e2e8f0;">
                                        <img src="{{ img.image.url }}" alt="ì´ë¯¸ì§€ {{ forloop.counter }}" style="width: 100%; height: 100%; object-fit: cover;">
                                        <input type="hidden" name="existing_image_ids" value="{{ img.id }}">
                                        <button type="button" onclick="deleteExistingImage({{ img.id }}, this)" style="position: absolute; top: 8px; right: 8px; width: 28px; height: 28px; border-radius: 50%; background: rgba(0, 0, 0, 0.6); color: white; border: none; cursor: pointer; font-size: 20px; display: flex; align-items: center; justify-content: center; line-height: 1;">Ã—</button>
                                    </div>
                                {% endfor %}
                            {% endif %}
                        </div>
                        <div id="imageUploadArea" onclick="document.getElementById('schedule_images').click()" style="width: 100%; aspect-ratio: 3/4; border: 2px dashed #3b82f6; border-radius: 8px; display: flex; flex-direction: column; align-items: center; justify-content: center; background: #f8fafc; cursor: pointer; margin-top: 12px;">
                            <div id="imageUploadAreaContent" style="text-align: center;">
                                <div id="imageUploadIcon" style="font-size: 32px; color: #3b82f6; margin-bottom: 8px;">ğŸ“·</div>
                                <div id="imageUploadText" style="font-size: 14px; color: #64748b; margin-bottom: 4px;">ë²ˆê°œ ì‚¬ì§„ì„ ë“±ë¡í•´ì£¼ì„¸ìš”.</div>
                                <div id="imageUploadSubtext" style="font-size: 12px; color: #94a3b8;">ë¹„ìœ¨ 3:4 (ìµœëŒ€ 5ì¥)</div>
                            </div>
                        </div>
                    </div>
                    
                    <!-- ë²ˆê°œ ì´ë¦„ -->
                    <div style="margin-bottom: 24px;">
                        <label for="id_name" style="display: block; margin-bottom: 8px; font-size: 14px; font-weight: 600; color: #1e293b;">
                            ë²ˆê°œ ì´ë¦„
                        </label>
                        <input type="text" name="name" id="id_name" class="form-input" placeholder="ë²ˆê°œ ì´ë¦„ì„ ì…ë ¥í•˜ì„¸ìš”" maxlength="200" required value="{% if is_update and schedule %}{{ schedule.title }}{% endif %}" style="box-sizing: border-box;">
                    </div>
                    
                    <!-- ë‚ ì§œ/ì‹œê°„ -->
                    <div style="margin-bottom: 24px;">
                        <label style="display: block; margin-bottom: 8px; font-size: 14px; font-weight: 600; color: #1e293b;">
                            ë‚ ì§œ/ì‹œê°„
                        </label>
                        <!-- ë‚ ì§œ -->
                        <div style="margin-bottom: 12px;">
                            <div style="position: relative;">
                                <span style="position: absolute; left: 12px; top: 50%; transform: translateY(-50%); font-size: 18px; z-index: 1; pointer-events: none;">ğŸ“…</span>
                                <input type="date" id="meeting_date" name="meeting_date" required class="form-input-with-icon" value="{% if is_update and schedule %}{{ schedule.start_datetime|date:'Y-m-d' }}{% endif %}" style="box-sizing: border-box; padding-left: 40px;">
                            </div>
                        </div>
                        <!-- ì‹œì‘ ì‹œê°„ -->
                        <div style="margin-bottom: 8px;">
                            <label style="display: block; margin-bottom: 6px; font-size: 13px; color: #64748b;">ì‹œì‘ ì‹œê°„</label>
                            <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 8px;">
                                <select id="meeting_hour" name="meeting_hour" required class="form-input" style="box-sizing: border-box; cursor: pointer;">
                                    <option value="">ì‹œ</option>
                                    {% for h in "012345678901234567890123"|make_list %}
                                        <option value="{{ forloop.counter0|stringformat:'02d' }}" {% if is_update and schedule and schedule.start_datetime|date:'H' == forloop.counter0|stringformat:'02d' %}selected{% endif %}>{{ forloop.counter0|stringformat:'02d' }}ì‹œ</option>
                                    {% endfor %}
                                </select>
                                <select id="meeting_minute" name="meeting_minute" required class="form-input" style="box-sizing: border-box; cursor: pointer;">
                                    <option value="">ë¶„</option>
                                    <option value="00" {% if is_update and schedule and schedule.start_datetime|date:'i' == '00' %}selected{% endif %}>00ë¶„</option>
                                    <option value="10" {% if is_update and schedule and schedule.start_datetime|date:'i' == '10' %}selected{% endif %}>10ë¶„</option>
                                    <option value="20" {% if is_update and schedule and schedule.start_datetime|date:'i' == '20' %}selected{% endif %}>20ë¶„</option>
                                    <option value="30" {% if is_update and schedule and schedule.start_datetime|date:'i' == '30' %}selected{% endif %}>30ë¶„</option>
                                    <option value="40" {% if is_update and schedule and schedule.start_datetime|date:'i' == '40' %}selected{% endif %}>40ë¶„</option>
                                    <option value="50" {% if is_update and schedule and schedule.start_datetime|date:'i' == '50' %}selected{% endif %}>50ë¶„</option>
                                </select>
                            </div>
                        </div>
                        <!-- ì¢…ë£Œ ì‹œê°„ -->
                        <div>
                            <label style="display: block; margin-bottom: 6px; font-size: 13px; color: #64748b;">ì¢…ë£Œ ì‹œê°„ (ì„ íƒ)</label>
                            <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 8px;">
                                <select id="meeting_end_hour" name="meeting_end_hour" class="form-input" style="box-sizing: border-box; cursor: pointer;">
                                    <option value="">ì‹œ</option>
                                    {% for h in "012345678901234567890123"|make_list %}
                                        <option value="{{ forloop.counter0|stringformat:'02d' }}" {% if is_update and schedule and schedule.end_datetime and schedule.end_datetime|date:'H' == forloop.counter0|stringformat:'02d' %}selected{% endif %}>{{ forloop.counter0|stringformat:'02d' }}ì‹œ</option>
                                    {% endfor %}
                                </select>
                                <select id="meeting_end_minute" name="meeting_end_minute" class="form-input" style="box-sizing: border-box; cursor: pointer;">
                                    <option value="">ë¶„</option>
                                    <option value="00" {% if is_update and schedule and schedule.end_datetime and schedule.end_datetime|date:'i' == '00' %}selected{% endif %}>00ë¶„</option>
                                    <option value="10" {% if is_update and schedule and schedule.end_datetime and schedule.end_datetime|date:'i' == '10' %}selected{% endif %}>10ë¶„</option>
                                    <option value="20" {% if is_update and schedule and schedule.end_datetime and schedule.end_datetime|date:'i' == '20' %}selected{% endif %}>20ë¶„</option>
                                    <option value="30" {% if is_update and schedule and schedule.end_datetime and schedule.end_datetime|date:'i' == '30' %}selected{% endif %}>30ë¶„</option>
                                    <option value="40" {% if is_update and schedule and schedule.end_datetime and schedule.end_datetime|date:'i' == '40' %}selected{% endif %}>40ë¶„</option>
                                    <option value="50" {% if is_update and schedule and schedule.end_datetime and schedule.end_datetime|date:'i' == '50' %}selected{% endif %}>50ë¶„</option>
                                </select>
                            </div>
                        </div>
                        <!-- Hidden inputs for form submission -->
                        <input type="hidden" id="meeting_time" name="meeting_time" value="">
                        <input type="hidden" id="meeting_end_time" name="meeting_end_time" value="">
                    </div>
                    
                    <!-- ìœ„ì¹˜ -->
                    <div style="margin-bottom: 24px;">
                        <label style="display: block; margin-bottom: 8px; font-size: 14px; font-weight: 600; color: #1e293b;">
                            ìœ„ì¹˜
                        </label>
                        <div style="display: grid; grid-template-columns: 20% 80%; gap: 8px; margin-bottom: 8px;">
                            <select id="flash_region" name="flash_region" required class="form-input" style="box-sizing: border-box; cursor: pointer;">
                                <option value="">ì§€ì—­ ì„ íƒ</option>
                                <option value="ì„œìš¸" {% if is_update and flash_region == "ì„œìš¸" %}selected{% endif %}>ì„œìš¸</option>
                                <option value="ê²½ê¸°" {% if is_update and flash_region == "ê²½ê¸°" %}selected{% endif %}>ê²½ê¸°</option>
                                <option value="ì¸ì²œ" {% if is_update and flash_region == "ì¸ì²œ" %}selected{% endif %}>ì¸ì²œ</option>
                                <option value="ë¶€ì‚°" {% if is_update and flash_region == "ë¶€ì‚°" %}selected{% endif %}>ë¶€ì‚°</option>
                                <option value="ëŒ€êµ¬" {% if is_update and flash_region == "ëŒ€êµ¬" %}selected{% endif %}>ëŒ€êµ¬</option>
                                <option value="ê´‘ì£¼" {% if is_update and flash_region == "ê´‘ì£¼" %}selected{% endif %}>ê´‘ì£¼</option>
                                <option value="ëŒ€ì „" {% if is_update and flash_region == "ëŒ€ì „" %}selected{% endif %}>ëŒ€ì „</option>
                                <option value="ìš¸ì‚°" {% if is_update and flash_region == "ìš¸ì‚°" %}selected{% endif %}>ìš¸ì‚°</option>
                                <option value="ê°•ì›" {% if is_update and flash_region == "ê°•ì›" %}selected{% endif %}>ê°•ì›</option>
                                <option value="ì„¸ì¢…" {% if is_update and flash_region == "ì„¸ì¢…" %}selected{% endif %}>ì„¸ì¢…</option>
                                <option value="ì¶©ë¶" {% if is_update and flash_region == "ì¶©ë¶" %}selected{% endif %}>ì¶©ë¶</option>
                                <option value="ì¶©ë‚¨" {% if is_update and flash_region == "ì¶©ë‚¨" %}selected{% endif %}>ì¶©ë‚¨</option>
                                <option value="ì „ë¶" {% if is_update and flash_region == "ì „ë¶" %}selected{% endif %}>ì „ë¶</option>
                                <option value="ì „ë‚¨" {% if is_update and flash_region == "ì „ë‚¨" %}selected{% endif %}>ì „ë‚¨</option>
                                <option value="ê²½ë¶" {% if is_update and flash_region == "ê²½ë¶" %}selected{% endif %}>ê²½ë¶</option>
                                <option value="ê²½ë‚¨" {% if is_update and flash_region == "ê²½ë‚¨" %}selected{% endif %}>ê²½ë‚¨</option>
                                <option value="ì œì£¼" {% if is_update and flash_region == "ì œì£¼" %}selected{% endif %}>ì œì£¼</option>
                            </select>
                            <div style="position: relative;">
                                <span style="position: absolute; left: 12px; top: 50%; transform: translateY(-50%); font-size: 18px; z-index: 1; pointer-events: none;">ğŸ“</span>
                                <input type="text" id="meeting_location" name="meeting_location" placeholder="ì •í™•í•œ ìœ„ì¹˜ë¥¼ ì…ë ¥í•˜ì„¸ìš”." required value="{% if is_update and schedule %}{{ schedule.location }}{% endif %}" class="form-input-with-icon" style="box-sizing: border-box;">
                            </div>
                        </div>
                        <button type="button" style="padding: 8px 16px; background: #f8fafc; border: 1px solid #e2e8f0; border-radius: 6px; font-size: 13px; color: #64748b; cursor: pointer; transition: all 0.2s ease;" onmouseover="this.style.background='#f1f5f9'" onmouseout="this.style.background='#f8fafc'">ì§€ë„ URL ì¶”ê°€</button>
                    </div>
                    
                    <!-- ë²ˆê°œ ì„¤ëª… -->
                    <div style="margin-bottom: 24px;">
                        <label for="flash_description" style="display: block; margin-bottom: 8px; font-size: 14px; font-weight: 600; color: #1e293b;">
                            ë²ˆê°œ ì„¤ëª…
                        </label>
                        <textarea name="flash_description" id="flash_description" class="form-input" placeholder="ë²ˆê°œì— ëŒ€í•œ ì„¤ëª…ì„ ì…ë ¥í•˜ì„¸ìš”" rows="4" style="box-sizing: border-box; resize: vertical;">{% if is_update and schedule %}{{ flash_description }}{% endif %}</textarea>
                    </div>
                    
                    <!-- ì°¸ê°€ë¹„ -->
                    <div style="margin-bottom: 24px;">
                        <label for="meeting_cost" style="display: block; margin-bottom: 8px; font-size: 14px; font-weight: 600; color: #1e293b;">
                            ì°¸ê°€ë¹„
                        </label>
                        <div style="position: relative;">
                            <span style="position: absolute; left: 12px; top: 50%; transform: translateY(-50%); font-size: 18px; z-index: 1; pointer-events: none;">â‚©</span>
                            <input type="number" id="meeting_cost" name="meeting_cost" placeholder="ì°¸ê°€ë¹„ë¥¼ ì…ë ¥í•˜ì„¸ìš”" min="0" value="{% if is_update and meeting_cost %}{{ meeting_cost }}{% endif %}" class="form-input-with-icon" style="box-sizing: border-box;">
                        </div>
                    </div>

                    <!-- ì…ê¸ˆ ê³„ì¢Œ -->
                    <div style="margin-bottom: 24px;">
                        <label for="bank_account" style="display: block; margin-bottom: 8px; font-size: 14px; font-weight: 600; color: #1e293b;">
                            ì…ê¸ˆ ê³„ì¢Œ
                        </label>
                        <input type="text" id="bank_account" name="bank_account" placeholder="ì¹´ì¹´ì˜¤ë±…í¬ 3333-00-0000000 í™ê¸¸ë™" value="{% if is_update and schedule.bank_account %}{{ schedule.bank_account }}{% endif %}" class="form-input" style="box-sizing: border-box;">
                        <p style="margin-top: 6px; font-size: 12px; color: #64748b;">ì°¸ê°€ë¹„ ì…ê¸ˆ ê³„ì¢Œë¥¼ ì…ë ¥í•˜ì„¸ìš”.</p>
                    </div>

                    <!-- ì •ì› -->
                    <div style="margin-bottom: 24px;">
                        <label for="meeting_capacity" style="display: block; margin-bottom: 8px; font-size: 14px; font-weight: 600; color: #1e293b;">
                            ì •ì› (5 ~ 300ëª…)
                        </label>
                        <div style="position: relative;">
                            <span style="position: absolute; left: 12px; top: 50%; transform: translateY(-50%); font-size: 18px; z-index: 1; pointer-events: none;">ğŸ‘¤</span>
                            <input type="number" id="meeting_capacity" name="meeting_capacity" value="{% if is_update and schedule %}{{ schedule.max_participants }}{% else %}20{% endif %}" min="5" max="300" required class="form-input-with-icon" style="box-sizing: border-box;">
                        </div>
                    </div>
                    
                    <!-- ë²ˆê°œ ê³µì§€ ì²´í¬ë°•ìŠ¤ -->
                    <div style="margin-bottom: 32px;">
                        <label style="display: flex; align-items: center; gap: 8px; cursor: pointer;">
                            <input type="checkbox" id="meeting_notification" name="meeting_notification" checked style="width: 18px; height: 18px; cursor: pointer; accent-color: var(--brand);">
                            <span style="font-size: 14px; color: #1e293b;">ë²ˆê°œ ê³µì§€ (ì „ì²´ ë©¤ë²„ ì•Œë¦¼)</span>
                        </label>
                    </div>
                    
                    <!-- ìˆ¨ê²¨ì§„ í•„ë“œë“¤ -->
                    <input type="hidden" name="band_type" value="flash">
                    <input type="hidden" name="region" value="all">
                    <input type="hidden" name="is_public" value="1">
                    <input type="hidden" name="join_approval_required" value="0">
                    <input type="hidden" name="description" value="">
                    
                {% else %}
                    <!-- ì¼ë°˜ ëª¨ì„/ë™í˜¸íšŒ íƒ€ì… -->
                    <!-- ë°°ë„ˆ ì´ë¯¸ì§€: ìƒë‹¨ìœ¼ë¡œ ì´ë™ -->
                    <div style="margin-bottom: 24px;">
                        <div style="display: flex; align-items: center; justify-content: space-between; margin-bottom: 8px;">
                            <label for="id_cover_image_group" style="display: block; font-size: 14px; font-weight: 600; color: #1e293b;">
                                ë°°ë„ˆ ì´ë¯¸ì§€
                            </label>
                            {% if is_update and band.cover_image %}
                                <div style="display: flex; align-items: center; gap: 4px;">
                                    <button type="button"
                                            onclick="document.getElementById('id_cover_image_group').click()"
                                            style="padding: 4px 10px; font-size: 12px; border-radius: 999px; border: 1px solid #e2e8f0; background: #f8fafc; color: #475569; cursor: pointer;">
                                        ì´ë¯¸ì§€ ë³€ê²½
                                    </button>
                                    <button type="button"
                                            onclick="clearCoverImage('group')"
                                            style="padding: 4px 10px; font-size: 12px; border-radius: 999px; border: 1px solid #fee2e2; background: #fef2f2; color: #b91c1c; cursor: pointer;">
                                        ì‚­ì œ
                                    </button>
                                </div>
                            {% endif %}
                        </div>
                        <p style="margin: 0 0 10px 0; padding: 10px 12px; background: #eff6ff; border: 1px solid #bfdbfe; border-radius: 6px; font-size: 13px; color: #1e40af; line-height: 1.5;">
                            <strong>ğŸ“ ì´ë¯¸ì§€ í¬ê¸°:</strong> 1200px Ã— 450px (ê³ ì • í¬ê¸°)<br>
                            <span style="font-size: 12px; color: #3b82f6;">ì´ í¬ê¸°ë¡œ ì œì‘í•˜ì‹œë©´ ë°ìŠ¤í¬í†±ê³¼ ëª¨ë°”ì¼ì—ì„œ ìµœì í™”ë˜ì–´ í‘œì‹œë©ë‹ˆë‹¤.</span>
                        </p>
                        <!-- í•­ìƒ ì¡´ì¬í•˜ëŠ” ìˆ¨ê²¨ì§„ íŒŒì¼ ì¸í’‹ -->
                        <input type="file" id="id_cover_image_group" name="cover_image" accept="image/*" style="display: none;" onchange="previewImage(this)">
                        <div id="imagePreviewGroup" onclick="document.getElementById('id_cover_image_group').click()" style="width: 100%; aspect-ratio: 8/3; border: 2px dashed #3b82f6; border-radius: 8px; display: {% if is_update and band.cover_image %}none{% else %}flex{% endif %}; flex-direction: column; align-items: center; justify-content: center; background: #f8fafc; cursor: pointer; position: relative; overflow: hidden;">
                            <div style="text-align: center;">
                                <div style="font-size: 32px; color: #3b82f6; margin-bottom: 8px;">ğŸ“·</div>
                                <div style="font-size: 14px; color: #64748b;">ëª¨ì„/ë™í˜¸íšŒ ë°°ë„ˆ ì´ë¯¸ì§€ë¥¼ ë“±ë¡í•´ì£¼ì„¸ìš”.</div>
                            </div>
                        </div>
                        <img id="previewImgGroup" src="{% if is_update and band.cover_image %}{{ band.cover_image.url }}{% endif %}" alt="ë¯¸ë¦¬ë³´ê¸°" onclick="document.getElementById('id_cover_image_group').click()" style="display: {% if is_update and band.cover_image %}block{% else %}none{% endif %}; width: 100%; aspect-ratio: 8/3; object-fit: cover; border-radius: 8px; margin-top: 8px; cursor: pointer;">
                    </div>
                    
                    <div style="margin-bottom: 24px;">
                        <div style="display: flex; align-items: center; justify-content: space-between; margin-bottom: 8px;">
                            <label for="id_profile_image" style="display: block; font-size: 14px; font-weight: 600; color: #1e293b;">
                                í”„ë¡œí•„ ì´ë¯¸ì§€
                            </label>
                            {% if is_update and band.profile_image %}
                                <div style="display: flex; align-items: center; gap: 4px;">
                                    <button type="button"
                                            onclick="document.getElementById('id_profile_image').click()"
                                            style="padding: 4px 10px; font-size: 12px; border-radius: 999px; border: 1px solid #e2e8f0; background: #f8fafc; color: #475569; cursor: pointer;">
                                        ì´ë¯¸ì§€ ë³€ê²½
                                    </button>
                                    <button type="button"
                                            onclick="clearProfileImage()"
                                            style="padding: 4px 10px; font-size: 12px; border-radius: 999px; border: 1px solid #fee2e2; background: #fef2f2; color: #b91c1c; cursor: pointer;">
                                        ì‚­ì œ
                                    </button>
                                </div>
                            {% endif %}
                        </div>
                        <!-- í•­ìƒ ì¡´ì¬í•˜ëŠ” ìˆ¨ê²¨ì§„ íŒŒì¼ ì¸í’‹ -->
                        <input type="file"
                               id="id_profile_image"
                               name="profile_image"
                               accept="image/*"
                               style="display: none;"
                               onchange="previewProfileImage(this)">
                        <input type="hidden" name="remove_cover_image" id="remove_cover_image" value="0">
                        <input type="hidden" name="remove_profile_image" id="remove_profile_image" value="0">

                        <div id="profileImagePreview"
                             onclick="document.getElementById('id_profile_image').click()"
                             style="display: {% if is_update and band.profile_image %}none{% else %}flex{% endif %}; align-items: center; gap: 12px; padding: 8px 12px; border: 2px dashed #e2e8f0; border-radius: 999px; background: #f8fafc; cursor: pointer; width: 100%; max-width: 280px;">
                            <div style="width: 64px; height: 64px; border-radius: 999px; background: #e5e7eb; display: flex; align-items: center; justify-content: center; font-size: 28px; color: #94a3b8;">
                                ğŸ‘¤
                            </div>
                            <div>
                                <div style="font-size: 13px; color: #64748b; margin-bottom: 2px;">í”„ë¡œí•„ ì´ë¯¸ì§€ë¥¼ ë“±ë¡í•´ì£¼ì„¸ìš”.</div>
                                <div style="font-size: 11px; color: #94a3b8;">ì •ì‚¬ê°í˜• 1:1, ìµœì†Œ 200Ã—200px ê¶Œì¥</div>
                            </div>
                        </div>
                        <div style="margin-top: 8px;">
                            <img id="profilePreviewImg"
                                 src="{% if is_update and band.profile_image %}{{ band.profile_image.url }}{% endif %}"
                                 alt="í”„ë¡œí•„ ë¯¸ë¦¬ë³´ê¸°"
                                 onclick="document.getElementById('id_profile_image').click()"
                                 style="display: {% if is_update and band.profile_image %}block{% else %}none{% endif %}; width: 96px; height: 96px; border-radius: 999px; object-fit: cover; cursor: pointer;">
                        </div>
                    </div>
                    
                    <!-- ìœ„ì¹˜ (ëª¨ì„/ë™í˜¸íšŒë„ ë²ˆê°œì™€ ë™ì¼í•œ UI ì‚¬ìš©) -->
                    <div style="margin-bottom: 24px;">
                        <label style="display: block; margin-bottom: 8px; font-size: 14px; font-weight: 600; color: #1e293b;">
                            ìœ„ì¹˜
                        </label>
                        <div style="display: grid; grid-template-columns: 20% 80%; gap: 8px; margin-bottom: 8px;">
                            <select id="group_region" name="group_region" class="form-input" style="box-sizing: border-box; cursor: pointer;">
                                <option value="">ì§€ì—­ ì„ íƒ</option>
                                <option value="ì„œìš¸" {% if group_region == "ì„œìš¸" %}selected{% endif %}>ì„œìš¸</option>
                                <option value="ê²½ê¸°" {% if group_region == "ê²½ê¸°" %}selected{% endif %}>ê²½ê¸°</option>
                                <option value="ì¸ì²œ" {% if group_region == "ì¸ì²œ" %}selected{% endif %}>ì¸ì²œ</option>
                                <option value="ë¶€ì‚°" {% if group_region == "ë¶€ì‚°" %}selected{% endif %}>ë¶€ì‚°</option>
                                <option value="ëŒ€êµ¬" {% if group_region == "ëŒ€êµ¬" %}selected{% endif %}>ëŒ€êµ¬</option>
                                <option value="ê´‘ì£¼" {% if group_region == "ê´‘ì£¼" %}selected{% endif %}>ê´‘ì£¼</option>
                                <option value="ëŒ€ì „" {% if group_region == "ëŒ€ì „" %}selected{% endif %}>ëŒ€ì „</option>
                                <option value="ìš¸ì‚°" {% if group_region == "ìš¸ì‚°" %}selected{% endif %}>ìš¸ì‚°</option>
                                <option value="ê°•ì›" {% if group_region == "ê°•ì›" %}selected{% endif %}>ê°•ì›</option>
                                <option value="ì„¸ì¢…" {% if group_region == "ì„¸ì¢…" %}selected{% endif %}>ì„¸ì¢…</option>
                                <option value="ì¶©ë¶" {% if group_region == "ì¶©ë¶" %}selected{% endif %}>ì¶©ë¶</option>
                                <option value="ì¶©ë‚¨" {% if group_region == "ì¶©ë‚¨" %}selected{% endif %}>ì¶©ë‚¨</option>
                                <option value="ì „ë¶" {% if group_region == "ì „ë¶" %}selected{% endif %}>ì „ë¶</option>
                                <option value="ì „ë‚¨" {% if group_region == "ì „ë‚¨" %}selected{% endif %}>ì „ë‚¨</option>
                                <option value="ê²½ë¶" {% if group_region == "ê²½ë¶" %}selected{% endif %}>ê²½ë¶</option>
                                <option value="ê²½ë‚¨" {% if group_region == "ê²½ë‚¨" %}selected{% endif %}>ê²½ë‚¨</option>
                                <option value="ì œì£¼" {% if group_region == "ì œì£¼" %}selected{% endif %}>ì œì£¼</option>
                            </select>
                            <div style="position: relative;">
                                <span style="position: absolute; left: 12px; top: 50%; transform: translateY(-50%); font-size: 18px; z-index: 1; pointer-events: none;">ğŸ“</span>
                                <input type="text" id="group_location" name="group_location" placeholder="ì •í™•í•œ ìœ„ì¹˜ë¥¼ ì…ë ¥í•˜ì„¸ìš”." value="{% if group_location %}{{ group_location }}{% endif %}" class="form-input-with-icon" style="box-sizing: border-box;">
                            </div>
                        </div>
                        <button type="button" style="padding: 8px 16px; background: #f8fafc; border: 1px solid #e2e8f0; border-radius: 6px; font-size: 13px; color: #64748b; cursor: pointer; transition: all 0.2s ease;" onmouseover="this.style.background='#f1f5f9'" onmouseout="this.style.background='#f8fafc'">ì§€ë„ URL ì¶”ê°€</button>
                    </div>
                    
                    <div style="margin-bottom: 24px;">
                        <label for="{{ form.name.id_for_label }}" style="display: block; margin-bottom: 8px; font-size: 14px; font-weight: 600; color: #1e293b;">
                            ëª¨ì„ ì´ë¦„ <span style="color: #dc2626;">*</span>
                        </label>
                {{ form.name }}
            </div>
            
                    <div style="margin-bottom: 24px;">
                        <label for="{{ form.description.id_for_label }}" style="display: block; margin-bottom: 8px; font-size: 14px; font-weight: 600; color: #1e293b;">
                            ëª¨ì„ í•œì¤„ ì†Œê°œ
                        </label>
                        <p style="margin: 0 0 8px 0; font-size: 12px; color: #64748b;">ì§§ì€ í•œì¤„ ì†Œê°œë¥¼ ì…ë ¥í•˜ì„¸ìš”.</p>
                {{ form.description }}
            </div>
            
                    <div style="margin-bottom: 24px;">
                        <label for="{{ form.detailed_description.id_for_label }}" style="display: block; margin-bottom: 8px; font-size: 14px; font-weight: 600; color: #1e293b;">
                            ëª¨ì„ ì„¤ëª…
                        </label>
                        <p style="margin: 0 0 8px 0; font-size: 12px; color: #64748b;">ëª¨ì„ì— ëŒ€í•œ ìƒì„¸í•œ ì„¤ëª…ì„ ì‘ì„±í•˜ì„¸ìš”.</p>
                {{ form.detailed_description }}
            </div>
            
                    <div style="margin-bottom: 24px;">
                        <label style="display: flex; align-items: center; gap: 8px; cursor: pointer;">
                    {{ form.is_public }}
                            <span style="font-size: 14px; color: #1e293b;">ê³µê°œ ëª¨ì„</span>
                </label>
                        <p style="margin: 4px 0 0 0; font-size: 12px; color: #64748b;">ê³µê°œ ëª¨ì„ì€ ëª¨ë“  ì‚¬ìš©ìê°€ ë³¼ ìˆ˜ ìˆìŠµë‹ˆë‹¤.</p>
            </div>
            
                    <div style="margin-bottom: 24px;">
                        <label style="display: flex; align-items: center; gap: 8px; cursor: pointer;">
                    {{ form.join_approval_required }}
                            <span style="font-size: 14px; color: #1e293b;">ê°€ì… ìŠ¹ì¸ í•„ìš”</span>
                </label>
                        <p style="margin: 4px 0 0 0; font-size: 12px; color: #64748b;">ì²´í¬í•˜ë©´ ê´€ë¦¬ìê°€ ê°€ì…ì„ ìŠ¹ì¸í•´ì•¼ í•©ë‹ˆë‹¤.</p>
            </div>
            
                    {{ form.band_type }}
                    <input type="hidden" name="region" value="all">
                {% endif %}
                
                <!-- ìƒì„± ë²„íŠ¼ -->
                <button type="submit" class="btn btn-primary" style="width: 100%; padding: 14px; font-size: 16px; font-weight: 600; margin-bottom: {% if is_update and band_type == 'flash' %}8px{% else %}12px{% endif %};">
                    {% if is_update %}{% if band_type == 'flash' %}ë²ˆê°œ ìˆ˜ì •í•˜ê¸°{% else %}ëª¨ì„ ìˆ˜ì •í•˜ê¸°{% endif %}{% else %}{% if band_type == 'flash' %}ë²ˆê°œ ë§Œë“¤ê¸°{% else %}ëª¨ì„ ë§Œë“¤ê¸°{% endif %}{% endif %}
                </button>
            </form>
            
            {% if is_update and band_type == 'flash' and schedule %}
            <form method="post" action="{% url 'band:schedule_delete' parent_band.id schedule.id %}" id="deleteScheduleForm" style="margin: 0;">
                {% csrf_token %}
                <button type="button" onclick="confirmDeleteSchedule()" style="width: 100%; padding: 14px; font-size: 16px; font-weight: 600; background: #fee2e2; color: #dc2626; border: 1px solid #fca5a5; border-radius: 8px; cursor: pointer; transition: all 0.2s;">
                    ë²ˆê°œ ì‚­ì œí•˜ê¸°
                </button>
            </form>
            {% endif %}
                
                {% if band_type == 'flash' %}
                    <p style="margin: 0; font-size: 12px; color: #94a3b8; text-align: center;">
                        í™ë³´ë¥¼ ìœ„í•œ í—ˆìœ„ ìƒì„± ì‹œ ëª¨ì„ ë…¸ì¶œë¥ ì´ ê°ì†Œë  ìˆ˜ ìˆìŠµë‹ˆë‹¤.
                    </p>
                {% endif %}
            </form>
            </div>
    </div>
</section>

<style>
    .form-input {
        width: 100%;
        padding: 12px 16px;
        border: 1px solid #e2e8f0;
        border-radius: 8px;
        font-size: 14px;
        transition: all 0.2s ease;
        box-sizing: border-box;
    }
    
    .form-input:focus {
        outline: none;
        border-color: var(--brand);
        box-shadow: 0 0 0 3px rgba(49, 170, 96, 0.1);
    }
    
    .form-input-with-icon {
        width: 100%;
        padding: 12px 12px 12px 40px;
        border: 1px solid #e2e8f0;
        border-radius: 8px;
        font-size: 14px;
        transition: all 0.2s ease;
        box-sizing: border-box;
    }
    
    .form-input-with-icon:focus {
        outline: none;
        border-color: var(--brand);
        box-shadow: 0 0 0 3px rgba(49, 170, 96, 0.1);
    }
    
    textarea.form-input {
        resize: vertical;
        min-height: 100px;
    }
    
    input[type="checkbox"] {
        accent-color: var(--brand);
    }
    
    input[type="date"],
    input[type="time"] {
        color: #1e293b;
    }
    
    input[type="date"]::-webkit-calendar-picker-indicator,
    input[type="time"]::-webkit-calendar-picker-indicator {
        cursor: pointer;
        opacity: 0.6;
    }
</style>

<script>
    function previewImage(input) {
        const file = input.files[0];
        if (!file) return;

        // ë°°ë„ˆ ì´ë¯¸ì§€ í¬ê¸° ê²€ì¦ (ëª¨ì„/ë™í˜¸íšŒìš©)
        const isGroupCover = input.id === 'id_cover_image_group';
        if (isGroupCover) {
            const img = new Image();
            let objectUrl = null;
            img.onload = function() {
                const width = img.width;
                const height = img.height;
                const recommendedWidth = 1200;
                const recommendedHeight = 450;
                const tolerance = 50; // 50px ì˜¤ì°¨ í—ˆìš©
                
                if (Math.abs(width - recommendedWidth) > tolerance || Math.abs(height - recommendedHeight) > tolerance) {
                    const confirmUpload = confirm(
                        `í˜„ì¬ ì´ë¯¸ì§€ í¬ê¸°: ${width}px Ã— ${height}px\n\n` +
                        `ê¶Œì¥ í¬ê¸°: ${recommendedWidth}px Ã— ${recommendedHeight}px\n\n` +
                        `ê¶Œì¥ í¬ê¸°ì™€ ë‹¤ë¦…ë‹ˆë‹¤. ê³„ì† ì—…ë¡œë“œí•˜ì‹œê² ìŠµë‹ˆê¹Œ?\n\n` +
                        `(ê¶Œì¥ í¬ê¸°ë¡œ ì œì‘í•˜ì‹œë©´ ìµœì í™”ë˜ì–´ í‘œì‹œë©ë‹ˆë‹¤.)`
                    );
                    
                    if (!confirmUpload) {
                        input.value = '';
                        if (objectUrl) URL.revokeObjectURL(objectUrl);
                        return;
                    }
                }
                
                // ì´ë¯¸ì§€ ë¯¸ë¦¬ë³´ê¸° í‘œì‹œ
                const reader = new FileReader();
                reader.onload = function(e) {
                    const previewGroup = document.getElementById('previewImgGroup');
                    const previewContainerGroup = document.getElementById('imagePreviewGroup');
                    if (previewGroup && previewContainerGroup) {
                        previewGroup.src = e.target.result;
                        previewGroup.style.display = 'block';
                        previewContainerGroup.style.display = 'none';
                    }
                    if (objectUrl) URL.revokeObjectURL(objectUrl);
                };
                reader.readAsDataURL(file);
            };
            img.onerror = function() {
                if (objectUrl) URL.revokeObjectURL(objectUrl);
                alert('ì´ë¯¸ì§€ë¥¼ ë¶ˆëŸ¬ì˜¬ ìˆ˜ ì—†ìŠµë‹ˆë‹¤.');
            };
            objectUrl = URL.createObjectURL(file);
            img.src = objectUrl;
        } else {
            // ë²ˆê°œìš© í”„ë¦¬ë·° (ê¸°ì¡´ ë¡œì§)
            const reader = new FileReader();
            reader.onload = function(e) {
                const preview = document.getElementById('previewImg');
                const previewContainer = document.getElementById('imagePreview');
                if (preview && previewContainer) {
                    preview.src = e.target.result;
                    preview.style.display = 'block';
                    previewContainer.style.display = 'none';
                }
            };
            reader.readAsDataURL(file);
        }
    }

    function previewProfileImage(input) {
        const file = input.files[0];
        if (!file) return;

        const reader = new FileReader();
        reader.onload = function(e) {
            const preview = document.getElementById('profilePreviewImg');
            const previewContainer = document.getElementById('profileImagePreview');
            if (preview && previewContainer) {
                preview.src = e.target.result;
                preview.style.display = 'block';
                previewContainer.style.display = 'none';
            }
        };
        reader.readAsDataURL(file);
    }

    function clearCoverImage(type) {
        const inputId = type === 'flash' ? 'id_cover_image' : 'id_cover_image_group';
        const previewId = type === 'flash' ? 'previewImg' : 'previewImgGroup';
        const containerId = type === 'flash' ? 'imagePreview' : 'imagePreviewGroup';
        const removeField = document.getElementById('remove_cover_image');

        const fileInput = document.getElementById(inputId);
        const preview = document.getElementById(previewId);
        const container = document.getElementById(containerId);

        if (fileInput) fileInput.value = '';
        if (preview) {
            preview.src = '';
            preview.style.display = 'none';
        }
        if (container) {
            container.style.display = 'flex';
        }
        if (removeField) {
            removeField.value = '1';
        }
    }

    function clearProfileImage() {
        const fileInput = document.getElementById('id_profile_image');
        const preview = document.getElementById('profilePreviewImg');
        const container = document.getElementById('profileImagePreview');
        const removeField = document.getElementById('remove_profile_image');

        if (fileInput) fileInput.value = '';
        if (preview) {
            preview.src = '';
            preview.style.display = 'none';
        }
        if (container) {
            container.style.display = 'flex';
        }
        if (removeField) {
            removeField.value = '1';
        }
    }

    // ë²ˆê°œ ì´ë¯¸ì§€ ì—…ë¡œë“œ ì²˜ë¦¬ (ìµœëŒ€ 5ì¥, 3:4 ë¹„ìœ¨)
    let scheduleImages = [];
    let deletedImageIds = [];
    let imageIdCounter = 0; // ê³ ìœ  ID ìƒì„±ìš© ì¹´ìš´í„°
    const maxImages = 5;
    
    // ê¸°ì¡´ ì´ë¯¸ì§€ ê°œìˆ˜ í™•ì¸
    const existingImageCount = {% if is_update and existing_images %}{{ existing_images|length }}{% else %}0{% endif %};
    
    function deleteExistingImage(imageId, button) {
        deletedImageIds.push(imageId);
        const imageDiv = button.closest('div');
        imageDiv.remove();
        
        const currentCount = document.querySelectorAll('#scheduleImagesContainer > div').length + scheduleImages.length;
        updateImageCount();
        
        // ì‚­ì œëœ ì´ë¯¸ì§€ IDë¥¼ hidden inputìœ¼ë¡œ ì¶”ê°€
        const deleteInput = document.createElement('input');
        deleteInput.type = 'hidden';
        deleteInput.name = 'delete_images';
        deleteInput.value = imageId;
        document.getElementById('bandForm').appendChild(deleteInput);
        
        // ì—…ë¡œë“œ ì˜ì—­ í‘œì‹œ ë° í¬ê¸° ì¡°ì •
        const uploadArea = document.getElementById('imageUploadArea');
        if (currentCount < maxImages) {
            uploadArea.style.display = 'flex';
            // ì´ë¯¸ì§€ê°€ 1ì¥ ì´ìƒì¼ ë•Œ ë°°ë„ˆ í¬ê¸°ë¥¼ 20%ë¡œ ì¶•ì†Œ
            const iconElement = document.getElementById('imageUploadIcon');
            const textElement = document.getElementById('imageUploadText');
            const subtextElement = document.getElementById('imageUploadSubtext');
            const contentElement = document.getElementById('imageUploadAreaContent');
            
            if (currentCount >= 1) {
                uploadArea.style.aspectRatio = 'none';
                uploadArea.style.height = '60px';
                uploadArea.style.minHeight = '60px';
                uploadArea.style.padding = '8px';
                if (iconElement) iconElement.style.fontSize = '20px';
                if (iconElement) iconElement.style.marginBottom = '4px';
                if (textElement) textElement.style.fontSize = '12px';
                if (textElement) textElement.style.marginBottom = '2px';
                if (subtextElement) subtextElement.style.fontSize = '10px';
                if (contentElement) contentElement.style.transform = 'scale(0.8)';
            } else {
                uploadArea.style.aspectRatio = '3/4';
                uploadArea.style.height = '';
                uploadArea.style.minHeight = '';
                uploadArea.style.padding = '';
                if (iconElement) iconElement.style.fontSize = '32px';
                if (iconElement) iconElement.style.marginBottom = '8px';
                if (textElement) textElement.style.fontSize = '14px';
                if (textElement) textElement.style.marginBottom = '4px';
                if (subtextElement) subtextElement.style.fontSize = '12px';
                if (contentElement) contentElement.style.transform = '';
            }
        }
    }
    
    function updateImageCount() {
        const imageCount = document.getElementById('imageCount');
        const currentCount = document.querySelectorAll('#scheduleImagesContainer > div').length + scheduleImages.length;
        if (imageCount) {
            imageCount.textContent = `${currentCount}/${maxImages}`;
        }
    }

    function handleScheduleImages(input) {
        const files = Array.from(input.files);
        const existingCount = document.querySelectorAll('#scheduleImagesContainer > div[data-existing-image]').length;
        const currentNewCount = scheduleImages.length;
        const remainingSlots = maxImages - existingCount - currentNewCount;
        
        if (files.length > remainingSlots) {
            alert(`ìµœëŒ€ ${maxImages}ì¥ê¹Œì§€ ì—…ë¡œë“œí•  ìˆ˜ ìˆìŠµë‹ˆë‹¤. (í˜„ì¬ ${existingCount + currentNewCount}ì¥, ì¶”ê°€ ê°€ëŠ¥ ${remainingSlots}ì¥)`);
            files.splice(remainingSlots);
        }

        // ëª¨ë“  íŒŒì¼ì„ ì½ì€ í›„ í•œ ë²ˆë§Œ í”„ë¦¬ë·° ì—…ë°ì´íŠ¸
        const readPromises = files.map((file, fileIndex) => {
            const currentTotal = existingCount + scheduleImages.length + fileIndex;
            if (currentTotal >= maxImages) {
                return Promise.resolve(null);
            }
            
            return new Promise((resolve) => {
                const reader = new FileReader();
                reader.onload = function(e) {
                    // ê³ ìœ  ID ìƒì„± (íƒ€ì„ìŠ¤íƒ¬í”„ + ì¹´ìš´í„° + íŒŒì¼ëª…)
                    const uniqueId = `new_${Date.now()}_${imageIdCounter++}_${file.name.replace(/[^a-zA-Z0-9]/g, '_')}`;
                    resolve({
                        id: uniqueId,
                        file: file,
                        preview: e.target.result
                    });
                };
                reader.onerror = function() {
                    resolve(null);
                };
                reader.readAsDataURL(file);
            });
        });

        Promise.all(readPromises).then((newImages) => {
            // nullì´ ì•„ë‹Œ ì´ë¯¸ì§€ë§Œ ì¶”ê°€
            const validImages = newImages.filter(img => img !== null);
            scheduleImages.push(...validImages);
            
            // ëª¨ë“  íŒŒì¼ì´ ì²˜ë¦¬ëœ í›„ í•œ ë²ˆë§Œ í”„ë¦¬ë·° ì—…ë°ì´íŠ¸
            updateScheduleImagePreview();
        });

        // íŒŒì¼ ì…ë ¥ ì´ˆê¸°í™” (ê°™ì€ íŒŒì¼ ë‹¤ì‹œ ì„ íƒ ê°€ëŠ¥í•˜ë„ë¡)
        input.value = '';
    }

    function updateScheduleImagePreview() {
        const container = document.getElementById('scheduleImagesContainer');
        const uploadArea = document.getElementById('imageUploadArea');
        const imageCount = document.getElementById('imageCount');

        // ê¸°ì¡´ ì´ë¯¸ì§€ëŠ” ìœ ì§€í•˜ê³  ìƒˆ ì´ë¯¸ì§€ë§Œ ì¶”ê°€
        const existingImages = container.querySelectorAll('div[data-existing-image]');
        const existingCount = existingImages.length;

        // ìƒˆë¡œ ì¶”ê°€ëœ ì´ë¯¸ì§€ í”„ë¦¬ë·° ì œê±° (ê¸°ì¡´ ì´ë¯¸ì§€ëŠ” ìœ ì§€)
        const newImagePreviews = container.querySelectorAll('div:not([data-existing-image])');
        newImagePreviews.forEach(preview => preview.remove());

        // ìƒˆ ì´ë¯¸ì§€ë§Œ ì¶”ê°€
        scheduleImages.forEach((imgData, index) => {
            // IDê°€ ì—†ìœ¼ë©´ ìƒì„± (ê¸°ì¡´ ë°ì´í„° í˜¸í™˜ì„±)
            if (!imgData.id) {
                imgData.id = `fallback_${Date.now()}_${index}`;
            }
            
            const imageDiv = document.createElement('div');
            imageDiv.setAttribute('data-new-image-id', imgData.id);
            imageDiv.style.position = 'relative';
            imageDiv.style.aspectRatio = '3/4';
            imageDiv.style.borderRadius = '8px';
            imageDiv.style.overflow = 'hidden';
            imageDiv.style.border = '1px solid #e2e8f0';
            
            const img = document.createElement('img');
            img.src = imgData.preview;
            img.style.width = '100%';
            img.style.height = '100%';
            img.style.objectFit = 'cover';
            
            const deleteBtn = document.createElement('button');
            deleteBtn.type = 'button';
            deleteBtn.innerHTML = 'Ã—';
            deleteBtn.style.position = 'absolute';
            deleteBtn.style.top = '8px';
            deleteBtn.style.right = '8px';
            deleteBtn.style.width = '28px';
            deleteBtn.style.height = '28px';
            deleteBtn.style.borderRadius = '50%';
            deleteBtn.style.background = 'rgba(0, 0, 0, 0.6)';
            deleteBtn.style.color = 'white';
            deleteBtn.style.border = 'none';
            deleteBtn.style.cursor = 'pointer';
            deleteBtn.style.fontSize = '20px';
            deleteBtn.style.display = 'flex';
            deleteBtn.style.alignItems = 'center';
            deleteBtn.style.justifyContent = 'center';
            deleteBtn.style.lineHeight = '1';
            
            // ID ê¸°ë°˜ìœ¼ë¡œ ì‚­ì œí•˜ì—¬ í´ë¡œì € ë¬¸ì œ í•´ê²°
            const imageId = imgData.id;
            deleteBtn.onclick = () => {
                const removeIndex = scheduleImages.findIndex(img => img.id === imageId);
                if (removeIndex !== -1) {
                    scheduleImages.splice(removeIndex, 1);
                    updateScheduleImagePreview();
                }
            };
            
            imageDiv.appendChild(img);
            imageDiv.appendChild(deleteBtn);
            container.appendChild(imageDiv);
        });
        
        updateImageCount();
        
        const currentCount = document.querySelectorAll('#scheduleImagesContainer > div').length;
        if (currentCount >= maxImages) {
            uploadArea.style.display = 'none';
        } else {
            uploadArea.style.display = 'flex';
            // ì´ë¯¸ì§€ê°€ 1ì¥ ì´ìƒì¼ ë•Œ ë°°ë„ˆ í¬ê¸°ë¥¼ 20%ë¡œ ì¶•ì†Œ
            const iconElement = document.getElementById('imageUploadIcon');
            const textElement = document.getElementById('imageUploadText');
            const subtextElement = document.getElementById('imageUploadSubtext');
            const contentElement = document.getElementById('imageUploadAreaContent');
            
            if (currentCount >= 1) {
                uploadArea.style.aspectRatio = 'none';
                uploadArea.style.height = '60px';
                uploadArea.style.minHeight = '60px';
                uploadArea.style.padding = '8px';
                if (iconElement) iconElement.style.fontSize = '20px';
                if (iconElement) iconElement.style.marginBottom = '4px';
                if (textElement) textElement.style.fontSize = '12px';
                if (textElement) textElement.style.marginBottom = '2px';
                if (subtextElement) subtextElement.style.fontSize = '10px';
                if (contentElement) contentElement.style.transform = 'scale(0.8)';
            } else {
                uploadArea.style.aspectRatio = '3/4';
                uploadArea.style.height = '';
                uploadArea.style.minHeight = '';
                uploadArea.style.padding = '';
                if (iconElement) iconElement.style.fontSize = '32px';
                if (iconElement) iconElement.style.marginBottom = '8px';
                if (textElement) textElement.style.fontSize = '14px';
                if (textElement) textElement.style.marginBottom = '4px';
                if (subtextElement) subtextElement.style.fontSize = '12px';
                if (contentElement) contentElement.style.transform = '';
            }
        }
    }
    
    // ê¸°ì¡´ ì´ë¯¸ì§€ ì‚­ì œ ì‹œ ì¤‘ë³µ ì¶”ê°€ ë°©ì§€
    function removeNewImageIfExists(imageId) {
        // ìƒˆë¡œ ì¶”ê°€ëœ ì´ë¯¸ì§€ ì¤‘ì—ì„œ ê°™ì€ íŒŒì¼ì´ ìˆëŠ”ì§€ í™•ì¸í•˜ê³  ì œê±°
        // (í˜„ì¬ëŠ” ê¸°ì¡´ ì´ë¯¸ì§€ë§Œ ì‚­ì œí•˜ë¯€ë¡œ í•„ìš” ì—†ìŒ)
    }
    
    // í˜ì´ì§€ ë¡œë“œ ì‹œ ì´ë¯¸ì§€ ê°œìˆ˜ ì—…ë°ì´íŠ¸ ë° ë°°ë„ˆ í¬ê¸° ì¡°ì •
    document.addEventListener('DOMContentLoaded', function() {
        updateImageCount();
        const uploadArea = document.getElementById('imageUploadArea');
        const currentCount = document.querySelectorAll('#scheduleImagesContainer > div').length;
        if (uploadArea && currentCount >= 1) {
            const iconElement = document.getElementById('imageUploadIcon');
            const textElement = document.getElementById('imageUploadText');
            const subtextElement = document.getElementById('imageUploadSubtext');
            const contentElement = document.getElementById('imageUploadAreaContent');
            
            uploadArea.style.aspectRatio = 'none';
            uploadArea.style.height = '60px';
            uploadArea.style.minHeight = '60px';
            uploadArea.style.padding = '8px';
            if (iconElement) iconElement.style.fontSize = '20px';
            if (iconElement) iconElement.style.marginBottom = '4px';
            if (textElement) textElement.style.fontSize = '12px';
            if (textElement) textElement.style.marginBottom = '2px';
            if (subtextElement) subtextElement.style.fontSize = '10px';
            if (contentElement) contentElement.style.transform = 'scale(0.8)';
        }
    });
    
    // ë²ˆê°œ ì‚­ì œ í™•ì¸ í•¨ìˆ˜
    function confirmDeleteSchedule() {
        if (confirm('ì •ë§ ì‚­ì œí•˜ì‹œê² ìŠµë‹ˆê¹Œ?\në³µêµ¬ê°€ ë¶ˆê°€ëŠ¥í•©ë‹ˆë‹¤.')) {
            document.getElementById('deleteScheduleForm').submit();
        }
    }

    // í¼ ì œì¶œ ì‹œ ì´ë¯¸ì§€ íŒŒì¼ë“¤ì„ ë™ì ìœ¼ë¡œ ì¶”ê°€
    document.addEventListener('DOMContentLoaded', function() {
        const form = document.getElementById('bandForm');
        if (form) {
            form.addEventListener('submit', function(e) {
                // ê¸°ì¡´ schedule_images ì…ë ¥ ì œê±°
                const existingInputs = form.querySelectorAll('input[name="schedule_images"]');
                existingInputs.forEach(input => input.remove());

                // ìƒˆë¡œ ì¶”ê°€ëœ ì´ë¯¸ì§€ê°€ ìˆëŠ” ê²½ìš°ì—ë§Œ íŒŒì¼ ì…ë ¥ ì¶”ê°€
                if (scheduleImages.length > 0) {
                    const fileInput = document.createElement('input');
                    fileInput.type = 'file';
                    fileInput.name = 'schedule_images';
                    fileInput.multiple = true;
                    fileInput.style.display = 'none';

                    // DataTransferë¥¼ ì‚¬ìš©í•˜ì—¬ ëª¨ë“  íŒŒì¼ì„ í•˜ë‚˜ì˜ inputì— ì¶”ê°€
                    const dataTransfer = new DataTransfer();
                    scheduleImages.forEach((imgData) => {
                        dataTransfer.items.add(imgData.file);
                    });
                    fileInput.files = dataTransfer.files;

                    form.appendChild(fileInput);
                }

                // ì‹œê°„ select ê°’ì„ hidden inputì— ë™ê¸°í™” (ë²ˆê°œ íƒ€ì…ë§Œ)
                const meetingHour = document.getElementById('meeting_hour');
                const meetingMinute = document.getElementById('meeting_minute');
                const meetingTime = document.getElementById('meeting_time');

                if (meetingHour && meetingMinute && meetingTime) {
                    const hour = meetingHour.value;
                    const minute = meetingMinute.value;

                    if (hour && minute) {
                        meetingTime.value = `${hour}:${minute}`;
                    }
                }

                // ì¢…ë£Œ ì‹œê°„ ë™ê¸°í™” (ì„ íƒì‚¬í•­)
                const meetingEndHour = document.getElementById('meeting_end_hour');
                const meetingEndMinute = document.getElementById('meeting_end_minute');
                const meetingEndTime = document.getElementById('meeting_end_time');

                if (meetingEndHour && meetingEndMinute && meetingEndTime) {
                    const endHour = meetingEndHour.value;
                    const endMinute = meetingEndMinute.value;

                    // ë‘˜ ë‹¤ ì„ íƒë˜ì–´ ìˆì„ ë•Œë§Œ ê°’ ì„¤ì •
                    if (endHour && endMinute) {
                        meetingEndTime.value = `${endHour}:${endMinute}`;
                    }
                }
            });
        }
    });
    
    // ë‚ ì§œ/ì‹œê°„ ê¸°ë³¸ê°’ ì„¤ì • ë° ë¶„ë¥˜ ì•„ì½”ë””ì–¸
    document.addEventListener('DOMContentLoaded', function() {
        const dateInput = document.getElementById('meeting_date');
        const timeInput = document.getElementById('meeting_time');
        
        if (dateInput && !dateInput.value) {
            const tomorrow = new Date();
            tomorrow.setDate(tomorrow.getDate() + 1);
            dateInput.value = tomorrow.toISOString().split('T')[0];
        }
        
        if (timeInput && !timeInput.value) {
            timeInput.value = '19:00';
        }
    });
</script>
{% endblock %}
