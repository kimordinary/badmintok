{% load static %}
<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>{% block title %}ë°°ë“œë¯¼í†¡{% endblock %}</title>
    <link rel="stylesheet" href="{% static 'css/fonts.css' %}">
    <link rel="stylesheet" href="{% static 'css/style.css' %}">
    <meta name="theme-color" content="#31AA60">
    {% block extra_head %}{% endblock %}
    <!-- ëª¨ë°”ì¼ ì˜¤ë²„ë ˆì´ í´ë¦­ ì°¨ë‹¨ ë°©ì§€ ìœ í‹¸ë¦¬í‹° (ê°€ì¥ ë¨¼ì € ë¡œë“œ) -->
    <script src="{% static 'js/mobile-overlay-fix.js' %}"></script>
</head>
<body>
    <header class="site-header">
        <div class="header-inner">
            <!-- ëª¨ë°”ì¼ í–„ë²„ê±° ë©”ë‰´ ë²„íŠ¼ -->
            <button class="mobile-menu-toggle" id="mobileMenuToggle" aria-label="ë©”ë‰´ ì—´ê¸°" aria-expanded="false">
                <span class="hamburger-line"></span>
                <span class="hamburger-line"></span>
                <span class="hamburger-line"></span>
            </button>

            <a class="logo" href="{% url 'home' %}" aria-label="Badmintok Home">Badmintok</a>

            <nav class="main-nav" aria-label="ì£¼ìš” ì¹´í…Œê³ ë¦¬">
                <ul>
                    <li><a class="{% if request.resolver_match and request.resolver_match.namespace == 'contests' %}active{% endif %}" href="{% url 'contests:list' %}">ì „êµ­ ë°°ë“œë¯¼í„´ ëŒ€íšŒ</a></li>
                    <li><a class="{% if request.resolver_match and request.resolver_match.view_name == 'badmintok' or request.resolver_match.view_name == 'news' or request.resolver_match.view_name == 'reviews' %}active{% endif %}" href="{% url 'badmintok' %}">ë°°ë“œë¯¼í†¡</a></li>
                    <li><a class="{% if request.resolver_match and request.resolver_match.namespace == 'community' %}active{% endif %}" href="{% url 'community:list' %}">ë™í˜¸ì¸í†¡</a></li>
                    <li><a class="{% if request.resolver_match and request.resolver_match.namespace == 'band' %}active{% endif %}" href="{% url 'band:list' %}">ì›¹ë¯¼í„´</a></li>
                </ul>
            </nav>

            <div class="auth-actions">
                {% if user.is_authenticated %}
                    <a href="{% url 'accounts:mypage' %}" class="mobile-profile-btn" aria-label="ë§ˆì´í˜ì´ì§€">
                        <img src="{{ user.profile_image_url }}" alt="{{ user.activity_name }} í”„ë¡œí•„" class="profile-avatar-mobile" width="32" height="32">
                    </a>
                    <div class="profile-preview">
                        <img src="{{ user.profile_image_url }}" alt="{{ user.activity_name }} í”„ë¡œí•„" class="profile-avatar" width="36" height="36">
                        <span class="welcome">{{ user.activity_name }} ë‹˜</span>
                    </div>
                    <form action="{% url 'accounts:logout' %}" method="post">
                        {% csrf_token %}
                        <button type="submit" class="btn btn-ghost">ë¡œê·¸ì•„ì›ƒ</button>
                    </form>
                {% else %}
                    <a class="btn btn-ghost mobile-login-btn" href="{% url 'accounts:login' %}">
                        <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                            <path d="M20 21v-2a4 4 0 0 0-4-4H8a4 4 0 0 0-4 4v2"></path>
                            <circle cx="12" cy="7" r="4"></circle>
                        </svg>
                    </a>
                    <a class="btn btn-ghost" href="{% url 'accounts:login' %}">ë¡œê·¸ì¸</a>
                    <a class="btn btn-primary" href="{% url 'accounts:signup' %}">íšŒì›ê°€ì…</a>
                {% endif %}
            </div>
        </div>
    </header>

    <!-- ëª¨ë°”ì¼ ë©”ë‰´ ì˜¤ë²„ë ˆì´ -->
    <div class="mobile-menu-overlay" id="mobileMenuOverlay"></div>

    <!-- ëª¨ë°”ì¼ ì‚¬ì´ë“œ ë©”ë‰´ -->
    <nav class="mobile-menu" id="mobileMenu" aria-label="ëª¨ë°”ì¼ ë©”ë‰´">
        <div class="mobile-menu-header">
            <span class="mobile-menu-title">ë©”ë‰´</span>
            <button class="mobile-menu-close" id="mobileMenuClose" aria-label="ë©”ë‰´ ë‹«ê¸°">
                <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                    <line x1="18" y1="6" x2="6" y2="18"></line>
                    <line x1="6" y1="6" x2="18" y2="18"></line>
                </svg>
            </button>
        </div>

        <div class="mobile-menu-user">
            {% if user.is_authenticated %}
                <div class="mobile-user-info">
                    <img src="{{ user.profile_image_url }}" alt="{{ user.activity_name }} í”„ë¡œí•„" class="mobile-user-avatar" width="48" height="48">
                    <div class="mobile-user-details">
                        <span class="mobile-user-name">{{ user.activity_name }} ë‹˜</span>
                        <a href="{% url 'accounts:mypage' %}" class="mobile-user-mypage">ë§ˆì´í˜ì´ì§€</a>
                    </div>
                </div>
            {% else %}
                <div class="mobile-auth-buttons">
                    <a href="{% url 'accounts:login' %}" class="btn btn-primary btn-block">ë¡œê·¸ì¸</a>
                    <a href="{% url 'accounts:signup' %}" class="btn btn-outline btn-block">íšŒì›ê°€ì…</a>
                </div>
            {% endif %}
        </div>

        <ul class="mobile-menu-list">
            <li>
                <a href="{% url 'home' %}" class="mobile-menu-item {% if request.resolver_match.view_name == 'home' %}active{% endif %}">
                    <span class="mobile-menu-icon">ğŸ </span>
                    <span class="mobile-menu-text">í™ˆ</span>
                </a>
            </li>
            <li>
                <a href="{% url 'contests:list' %}" class="mobile-menu-item {% if request.resolver_match and request.resolver_match.namespace == 'contests' %}active{% endif %}">
                    <span class="mobile-menu-icon">ğŸ†</span>
                    <span class="mobile-menu-text">ì „êµ­ ë°°ë“œë¯¼í„´ ëŒ€íšŒ</span>
                </a>
            </li>
            <li>
                <a href="{% url 'badmintok' %}" class="mobile-menu-item {% if request.resolver_match and request.resolver_match.view_name == 'badmintok' or request.resolver_match.view_name == 'news' or request.resolver_match.view_name == 'reviews' %}active{% endif %}">
                    <span class="mobile-menu-icon">ğŸ“°</span>
                    <span class="mobile-menu-text">ë°°ë“œë¯¼í†¡</span>
                </a>
            </li>
            <li>
                <a href="{% url 'community:list' %}" class="mobile-menu-item {% if request.resolver_match and request.resolver_match.namespace == 'community' %}active{% endif %}">
                    <span class="mobile-menu-icon">ğŸ’¬</span>
                    <span class="mobile-menu-text">ë™í˜¸ì¸í†¡</span>
                </a>
            </li>
            <li>
                <a href="{% url 'band:list' %}" class="mobile-menu-item {% if request.resolver_match and request.resolver_match.namespace == 'band' %}active{% endif %}">
                    <span class="mobile-menu-icon">ğŸ‘¥</span>
                    <span class="mobile-menu-text">ì›¹ë¯¼í„´</span>
                </a>
            </li>
        </ul>

        {% if user.is_authenticated %}
        <div class="mobile-menu-footer">
            <form action="{% url 'accounts:logout' %}" method="post" style="width: 100%;">
                {% csrf_token %}
                <button type="submit" class="btn btn-ghost btn-block">ë¡œê·¸ì•„ì›ƒ</button>
            </form>
        </div>
        {% endif %}
    </nav>

    <div class="scroll-progress" id="scrollProgress"></div>

    {% if messages %}
        <div class="messages-banner">
            {% for message in messages %}
                <div class="message-banner message-banner-{{ message.tags }}" data-auto-dismiss="{% if message.tags == 'success' or message.tags == 'info' %}true{% else %}false{% endif %}">
                    <div class="message-banner-content">
                        <span class="message-banner-icon">
                            {% if message.tags == 'error' %}âš ï¸
                            {% elif message.tags == 'success' %}âœ…
                            {% elif message.tags == 'warning' %}âš ï¸
                            {% else %}â„¹ï¸{% endif %}
                        </span>
                        <span class="message-banner-text">{{ message }}</span>
                    </div>
                    <button class="message-banner-close" onclick="this.parentElement.remove()" aria-label="ë‹«ê¸°">Ã—</button>
                </div>
            {% endfor %}
        </div>
    {% endif %}

    <main>
        {% block content %}{% endblock %}
    </main>

    <footer class="site-footer" aria-labelledby="footer-title">
        <div class="container footer-grid">
            <div>
                <h3 id="footer-title">ë°°ë“œë¯¼í†¡</h3>
                <p class="muted">ì˜¨ë¼ì¸ ë°°ë“œë¯¼í„´ì¥, ë™í˜¸ì¸ No.1 ì»¤ë®¤ë‹ˆí‹°</p>
                <p style="margin-top: 12px; font-size: 12px; color: #94a3b8; line-height: 1.5; width: 80%;">â€» ë³¸ ì‚¬ì´íŠ¸ì—ëŠ” ì¼ë¶€ ì œíœ´ ë§í¬ ë° ìœ ë£Œ ê´‘ê³ ê°€ í¬í•¨ë  ìˆ˜ ìˆìœ¼ë©°, ìš´ì˜ì„ ìœ„í•œ ìˆ˜ìµì´ ë°œìƒí•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.</p>
            </div>
            <div>
                <h4>ì„œë¹„ìŠ¤</h4>
                <ul>
                    <li><a href="{% url 'contests:list' %}">ì „êµ­ ë°°ë“œë¯¼í„´ ëŒ€íšŒ</a></li>
                    <li><a href="{% url 'community:list' %}">ë™í˜¸ì¸í†¡</a></li>
                    <li><a href="{% url 'band:list' %}">ì›¹ë¯¼í„´</a></li>
                    <li><a href="{% url 'badmintok' %}">ë°°ë“œë¯¼í†¡</a></li>
                </ul>
            </div>
            <div>
                <h4>ê³ ê°ì§€ì›</h4>
                <ul>
                    <li><a href="{% url 'notice_list' %}">ê³µì§€ì‚¬í•­</a></li>
                    <li><a href="#">ë¬¸ì˜í•˜ê¸°</a></li>
                    <li><a href="{% url 'terms' %}">ì´ìš©ì•½ê´€</a></li>
                    <li><a href="{% url 'privacy' %}">ê°œì¸ì •ë³´ì²˜ë¦¬ë°©ì¹¨</a></li>
                </ul>
            </div>
            <div>
                <h4>íŒ”ë¡œìš°</h4>
                <ul>
                    <li><a href="https://www.instagram.com/badmintok_korea/" target="_blank" rel="noopener noreferrer">Instagram</a></li>
                    <li><a href="https://www.youtube.com/@badmintok_korea" target="_blank" rel="noopener noreferrer">YouTube</a></li>
                    <li><a href="https://www.facebook.com/people/%EB%B0%B0%EB%93%9C%EB%AF%BC%ED%86%A1/61579067079012/?mibextid=wwXIfr&rdid=dbGY14DJNgHZaD5I&share_url=https%3A%2F%2Fwww.facebook.com%2Fshare%2F1Agj9vy59q%2F%3Fmibextid%3DwwXIfr" target="_blank" rel="noopener noreferrer">Facebook</a></li>
                </ul>
            </div>
        </div>
        <div class="footer-bottom">
            <div class="container">
                <small>Â© 2025 Badmintok. All rights reserved.</small>
                <br>
                <small>(ì£¼) í‰ë²”í•œ : 638-09-02602</small>
            </div>
        </div>
    </footer>

    {% block extra_scripts %}{% endblock %}

    <script>
        (function() {
            const scrollProgress = document.getElementById('scrollProgress');
            const siteHeader = document.querySelector('.site-header');
            const main = document.querySelector('main');

            function setProgressBarPosition() {
                if (siteHeader) {
                    const headerHeight = siteHeader.offsetHeight;
                    scrollProgress.style.top = headerHeight + 'px';
                    // mainì— í—¤ë” ë†’ì´ë§Œí¼ padding-top ì¶”ê°€ (í•œ ë²ˆë§Œ)
                    if (main && !main.dataset.paddingSet) {
                        main.style.paddingTop = headerHeight + 'px';
                        main.dataset.paddingSet = 'true';
                    }
                }
            }

            function updateScrollProgress() {
                const windowHeight = window.innerHeight;
                const documentHeight = document.documentElement.scrollHeight;
                const scrollTop = window.pageYOffset || document.documentElement.scrollTop;
                const scrollableHeight = documentHeight - windowHeight;
                const scrollPercentage = (scrollTop / scrollableHeight) * 100;

                scrollProgress.style.width = Math.min(scrollPercentage, 100) + '%';
            }

            // í—¤ë” ë†’ì´ì— ë§ì¶° ì§„í–‰ë°” ìœ„ì¹˜ ë° main padding ì„¤ì •
            // DOMì´ ì™„ì „íˆ ë¡œë“œëœ í›„ì— ì‹¤í–‰
            if (document.readyState === 'loading') {
                document.addEventListener('DOMContentLoaded', setProgressBarPosition);
            } else {
                setProgressBarPosition();
            }

            // ìŠ¤í¬ë¡¤ ì´ë²¤íŠ¸ ë¦¬ìŠ¤ë„ˆ ì¶”ê°€
            window.addEventListener('scroll', updateScrollProgress);
            window.addEventListener('resize', function() {
                updateScrollProgress();
            });

            // ì´ˆê¸° ë¡œë“œ ì‹œ ì‹¤í–‰
            updateScrollProgress();
        })();

        // ëª¨ë°”ì¼ ë©”ë‰´ í† ê¸€
        (function() {
            const mobileMenuToggle = document.getElementById('mobileMenuToggle');
            const mobileMenuClose = document.getElementById('mobileMenuClose');
            const mobileMenu = document.getElementById('mobileMenu');
            const mobileMenuOverlay = document.getElementById('mobileMenuOverlay');
            const body = document.body;

            function openMobileMenu() {
                mobileMenu.classList.add('active');
                mobileMenuOverlay.classList.add('active');
                mobileMenuToggle.setAttribute('aria-expanded', 'true');
                body.style.overflow = 'hidden';
            }

            function closeMobileMenu() {
                if (mobileMenu) {
                    mobileMenu.classList.remove('active');
                }
                if (mobileMenuOverlay) {
                    mobileMenuOverlay.classList.remove('active');
                }
                if (mobileMenuToggle) {
                    mobileMenuToggle.setAttribute('aria-expanded', 'false');
                }
                if (body) {
                    body.style.overflow = '';
                }
            }

            if (mobileMenuToggle) {
                mobileMenuToggle.addEventListener('click', function(e) {
                    e.preventDefault();
                    e.stopPropagation();
                    console.log('Mobile menu toggle clicked');
                    if (mobileMenu && mobileMenu.classList.contains('active')) {
                        closeMobileMenu();
                    } else {
                        openMobileMenu();
                    }
                });
            } else {
                console.error('mobileMenuToggle not found');
            }
            
            if (!mobileMenu) {
                console.error('mobileMenu not found');
            }
            
            if (!mobileMenuOverlay) {
                console.error('mobileMenuOverlay not found');
            }

            if (mobileMenuClose) {
                mobileMenuClose.addEventListener('click', closeMobileMenu);
            }

            if (mobileMenuOverlay) {
                mobileMenuOverlay.addEventListener('click', closeMobileMenu);
            }

            // ESC í‚¤ë¡œ ë©”ë‰´ ë‹«ê¸°
            document.addEventListener('keydown', function(e) {
                if (e.key === 'Escape' && mobileMenu.classList.contains('active')) {
                    closeMobileMenu();
                }
            });

            // ë©”ë‰´ ì•„ì´í…œ í´ë¦­ ì‹œ ë©”ë‰´ ë‹«ê¸°
            const mobileMenuItems = document.querySelectorAll('.mobile-menu-item');
            mobileMenuItems.forEach(function(item) {
                item.addEventListener('click', function() {
                    closeMobileMenu();
                });
            });
        })();

        // ë©”ì‹œì§€ ë°°ë„ˆ ìë™ ë‹«ê¸°
        (function() {
            const messageBanners = document.querySelectorAll('.message-banner');
            messageBanners.forEach(function(banner) {
                const autoDismiss = banner.getAttribute('data-auto-dismiss') === 'true';

                if (autoDismiss) {
                    // 3ì´ˆ í›„ í˜ì´ë“œì•„ì›ƒ ì‹œì‘
                    setTimeout(function() {
                        banner.style.transition = 'opacity 0.3s ease, transform 0.3s ease';
                        banner.style.opacity = '0';
                        banner.style.transform = 'translateY(-10px)';

                        // ì• ë‹ˆë©”ì´ì…˜ ì™„ë£Œ í›„ ì œê±°
                        setTimeout(function() {
                            banner.remove();
                        }, 300);
                    }, 3000);
                }
            });
        })();
    </script>
</body>
</html>
